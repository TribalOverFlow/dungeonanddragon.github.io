/*! tw2overflow.min.js@1.0.3 | Licence MIT */
!function(a,b){define("Lockr",function(a,b){"use strict";return b.prefix="",b._getPrefixedKey=function(a,b){return b=b||{},b.noPrefix?a:this.prefix+a},b.set=function(a,b,c){var d=this._getPrefixedKey(a,c);try{localStorage.setItem(d,JSON.stringify({data:b}))}catch(a){}},b.get=function(a,b,c){var d,e=this._getPrefixedKey(a,c);try{d=JSON.parse(localStorage.getItem(e))}catch(a){d=localStorage[e]?{data:localStorage.getItem(e)}:null}return null===d?b:"object"==typeof d&&void 0!==d.data?d.data:b},b}(a,{}))}(this),function(){var a,b,c,d=function(a,b){return function(){return a.apply(b,arguments)}};a=function(){function a(){this.translate=d(this.translate,this),this.data={values:{},contexts:[]},this.globalContext={}}return a.prototype.translate=function(a,b,c,d,e){var f,g,h,i;return null==e&&(e=this.globalContext),h=function(a){var b;return"function"===(b=typeof a)||"object"===b&&!!a},h(b)?(f=null,i=null,g=b,e=c||this.globalContext):"number"==typeof b?(f=null,i=b,g=c,e=d||this.globalContext):(f=b,"number"==typeof c?(i=c,g=d,e=e):(i=null,g=c,e=d||this.globalContext)),h(a)?(h(a.i18n)&&(a=a.i18n),this.translateHash(a,e)):this.translateText(a,i,g,e,f)},a.prototype.add=function(a){var b,c,d,e,f,g,h,i;if(null!=a.values){g=a.values;for(c in g)d=g[c],this.data.values[c]=d}if(null!=a.contexts){for(h=a.contexts,i=[],e=0,f=h.length;e<f;e++)b=h[e],i.push(this.data.contexts.push(b));return i}},a.prototype.setContext=function(a,b){return this.globalContext[a]=b},a.prototype.clearContext=function(a){return this.lobalContext[a]=null},a.prototype.reset=function(){return this.data={values:{},contexts:[]},this.globalContext={}},a.prototype.resetData=function(){return this.data={values:{},contexts:[]}},a.prototype.resetContext=function(){return this.globalContext={}},a.prototype.translateHash=function(a,b){var c,d;for(c in a)"string"==typeof(d=a[c])&&(a[c]=this.translateText(d,null,null,b));return a},a.prototype.translateText=function(a,b,c,d,e){var f,g;return null==d&&(d=this.globalContext),null==this.data?this.useOriginalText(e||a,b,c):(f=this.getContextData(this.data,d),null!=f&&(g=this.findTranslation(a,b,c,f.values,e)),null==g&&(g=this.findTranslation(a,b,c,this.data.values,e)),null==g?this.useOriginalText(e||a,b,c):g)},a.prototype.findTranslation=function(a,b,c,d){var e,f,g,h,i;if(null==(g=d[a]))return null;if(null==b){if("string"==typeof g)return this.applyFormatting(g,b,c)}else if(g instanceof Array||g.length)for(h=0,i=g.length;h<i;h++)if(f=g[h],(b>=f[0]||null===f[0])&&(b<=f[1]||null===f[1]))return e=this.applyFormatting(f[2].replace("-%n",String(-b)),b,c),this.applyFormatting(e.replace("%n",String(b)),b,c);return null},a.prototype.getContextData=function(a,b){var c,d,e,f,g,h,i,j;if(null==a.contexts)return null;for(i=a.contexts,g=0,h=i.length;g<h;g++){c=i[g],d=!0,j=c.matches;for(e in j)f=j[e],d=d&&f===b[e];if(d)return c}return null},a.prototype.useOriginalText=function(a,b,c){return null==b?this.applyFormatting(a,b,c):this.applyFormatting(a.replace("%n",String(b)),b,c)},a.prototype.applyFormatting=function(a,b,c){var d,e;for(d in c)e=new RegExp("%{"+d+"}","g"),a=a.replace(e,c[d]);return a},a}(),c=new a,b=c.translate,b.translator=c,b.create=function(c){var d;return d=new a,null!=c&&d.add(c),d.translate.create=b.create,d.translate},define("i18n",function(){return b})}.call(this),function(a){define("ejs",function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c||a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"use strict";function d(a,b){var d;if("/"==a.charAt(0))d=c.resolveInclude(a.replace(/^\/*/,""),b.root||"/",!0);else{if(!b.filename)throw new Error("`include` use relative path requires the 'filename' option.");d=c.resolveInclude(a,b.filename)}return d}function e(a,b){var d,e=a.filename,f=arguments.length>1;if(a.cache){if(!e)throw new Error("cache option requires a filename");if(d=c.cache.get(e))return d;f||(b=g(e).toString().replace(v,""))}else if(!f){if(!e)throw new Error("Internal EJS error: no file name or template provided");b=g(e).toString().replace(v,"")}return d=c.compile(b,a),a.cache&&c.cache.set(e,d),d}function f(a,b,c){var d;try{d=e(a)(b)}catch(a){return c(a)}return c(null,d)}function g(a){return c.fileLoader(a)}function h(a,b){var c=o.shallowCopy({},b);return c.filename=d(a,c),e(c)}function i(a,b){var c,e,f=o.shallowCopy({},b);c=d(a,f),e=g(c).toString().replace(v,""),f.filename=c;var h=new l(e,f);return h.generateSource(),{source:h.source,filename:c,template:e}}function j(a,b,c,d,e){var f=b.split("\n"),g=Math.max(d-3,0),h=Math.min(f.length,d+3),i=e(c),j=f.slice(g,h).map(function(a,b){var c=b+g+1;return(c==d?" >> ":"    ")+c+"| "+a}).join("\n");throw a.path=i,a.message=(i||"ejs")+":"+d+"\n"+j+"\n\n"+a.message,a}function k(a){return a.replace(/;(\s*$)/,"$1")}function l(a,b){b=b||{};var d={};this.templateText=a,this.mode=null,this.truncate=!1,this.currentLine=1,this.source="",this.dependencies=[],d.client=b.client||!1,d.escapeFunction=b.escape||o.escapeXML,d.compileDebug=!1!==b.compileDebug,d.debug=!!b.debug,d.filename=b.filename,d.delimiter=b.delimiter||c.delimiter||r,d.strict=b.strict||!1,d.context=b.context,d.cache=b.cache||!1,d.rmWhitespace=b.rmWhitespace,d.root=b.root,d.localsName=b.localsName||c.localsName||s,d.strict?d._with=!1:d._with=void 0===b._with||b._with,this.opts=d,this.regex=this.createRegex()}var m=a("fs"),n=a("path"),o=a("./utils"),p=!1,q=a("../package.json").version,r="%",s="locals",t=["delimiter","scope","context","debug","compileDebug","client","_with","rmWhitespace","strict","filename"],u=t.concat("cache"),v=/^\uFEFF/;c.cache=o.cache,c.fileLoader=m.readFileSync,c.localsName=s,c.resolveInclude=function(a,b,c){var d=n.dirname,e=n.extname,f=n.resolve,g=f(c?b:d(b),a);return e(a)||(g+=".ejs"),g},c.compile=function(a,b){var c;return b&&b.scope&&(p||(console.warn("`scope` option is deprecated and will be removed in EJS 3"),p=!0),b.context||(b.context=b.scope),delete b.scope),c=new l(a,b),c.compile()},c.render=function(a,b,c){var d=b||{},f=c||{};return 2==arguments.length&&o.shallowCopyFromList(f,d,t),e(f,a)(d)},c.renderFile=function(){var a,b=arguments[0],c=arguments[arguments.length-1],d={filename:b};return arguments.length>2?(a=arguments[1],3===arguments.length?a.settings&&a.settings["view options"]?o.shallowCopyFromList(d,a.settings["view options"],u):o.shallowCopyFromList(d,a,u):o.shallowCopy(d,arguments[2]),d.filename=b):a={},f(d,a,c)},c.clearCache=function(){c.cache.reset()},l.modes={EVAL:"eval",ESCAPED:"escaped",RAW:"raw",COMMENT:"comment",LITERAL:"literal"},l.prototype={createRegex:function(){var a="(<%%|%%>|<%=|<%-|<%_|<%#|<%|%>|-%>|_%>)",b=o.escapeRegExpChars(this.opts.delimiter);return a=a.replace(/%/g,b),new RegExp(a)},compile:function(){var a,b,c=this.opts,d="",e="",f=c.escapeFunction;this.source||(this.generateSource(),d+="  var __output = [], __append = __output.push.bind(__output);\n",!1!==c._with&&(d+="  with ("+c.localsName+" || {}) {\n",e+="  }\n"),e+='  return __output.join("");\n',this.source=d+this.source+e),a=c.compileDebug?"var __line = 1\n  , __lines = "+JSON.stringify(this.templateText)+"\n  , __filename = "+(c.filename?JSON.stringify(c.filename):"undefined")+";\ntry {\n"+this.source+"} catch (e) {\n  rethrow(e, __lines, __filename, __line, escapeFn);\n}\n":this.source,c.debug&&console.log(a),c.client&&(a="escapeFn = escapeFn || "+f.toString()+";\n"+a,c.compileDebug&&(a="rethrow = rethrow || "+j.toString()+";\n"+a)),c.strict&&(a='"use strict";\n'+a);try{b=new Function(c.localsName+", escapeFn, include, rethrow",a)}catch(a){throw a instanceof SyntaxError&&(c.filename&&(a.message+=" in "+c.filename),a.message+=" while compiling ejs\n\n",a.message+="If the above error is not helpful, you may want to try EJS-Lint:\n",a.message+="https://github.com/RyanZim/EJS-Lint"),a}if(c.client)return b.dependencies=this.dependencies,b;var g=function(a){var d=function(b,d){var e=o.shallowCopy({},a);return d&&(e=o.shallowCopy(e,d)),h(b,c)(e)};return b.apply(c.context,[a||{},f,d,j])};return g.dependencies=this.dependencies,g},generateSource:function(){this.opts.rmWhitespace&&(this.templateText=this.templateText.replace(/\r/g,"").replace(/^\s+|\s+$/gm,"")),this.templateText=this.templateText.replace(/[ \t]*<%_/gm,"<%_").replace(/_%>[ \t]*/gm,"_%>");var a=this,b=this.parseTemplateText(),d=this.opts.delimiter;b&&b.length&&b.forEach(function(e,f){var g,h,j,k,l,m;if(0===e.indexOf("<"+d)&&0!==e.indexOf("<"+d+d)&&(h=b[f+2])!=d+">"&&h!="-"+d+">"&&h!="_"+d+">")throw new Error('Could not find matching close tag for "'+e+'".');if((j=e.match(/^\s*include\s+(\S+)/))&&(g=b[f-1])&&(g=="<"+d||g=="<"+d+"-"||g=="<"+d+"_"))return k=o.shallowCopy({},a.opts),l=i(j[1],k),m=a.opts.compileDebug?"    ; (function(){\n      var __line = 1\n      , __lines = "+JSON.stringify(l.template)+"\n      , __filename = "+JSON.stringify(l.filename)+";\n      try {\n"+l.source+"      } catch (e) {\n        rethrow(e, __lines, __filename, __line);\n      }\n    ; }).call(this)\n":"    ; (function(){\n"+l.source+"    ; }).call(this)\n",a.source+=m,void a.dependencies.push(c.resolveInclude(j[1],k.filename));a.scanLine(e)})},parseTemplateText:function(){for(var a,b=this.templateText,c=this.regex,d=c.exec(b),e=[];d;)a=d.index,0!==a&&(e.push(b.substring(0,a)),b=b.slice(a)),e.push(d[0]),b=b.slice(d[0].length),d=c.exec(b);return b&&e.push(b),e},scanLine:function(a){function b(){c.truncate?(a=a.replace(/^(?:\r\n|\r|\n)/,""),c.truncate=!1):c.opts.rmWhitespace&&(a=a.replace(/^\n/,"")),a&&(a=a.replace(/\\/g,"\\\\"),a=a.replace(/\n/g,"\\n"),a=a.replace(/\r/g,"\\r"),a=a.replace(/"/g,'\\"'),c.source+='    ; __append("'+a+'")\n')}var c=this,d=this.opts.delimiter,e=0;switch(e=a.split("\n").length-1,a){case"<"+d:case"<"+d+"_":this.mode=l.modes.EVAL;break;case"<"+d+"=":this.mode=l.modes.ESCAPED;break;case"<"+d+"-":this.mode=l.modes.RAW;break;case"<"+d+"#":this.mode=l.modes.COMMENT;break;case"<"+d+d:this.mode=l.modes.LITERAL,this.source+='    ; __append("'+a.replace("<"+d+d,"<"+d)+'")\n';break;case d+d+">":this.mode=l.modes.LITERAL,this.source+='    ; __append("'+a.replace(d+d+">",d+">")+'")\n';break;case d+">":case"-"+d+">":case"_"+d+">":this.mode==l.modes.LITERAL&&b(),this.mode=null,this.truncate=0===a.indexOf("-")||0===a.indexOf("_");break;default:if(this.mode){switch(this.mode){case l.modes.EVAL:case l.modes.ESCAPED:case l.modes.RAW:a.lastIndexOf("//")>a.lastIndexOf("\n")&&(a+="\n")}switch(this.mode){case l.modes.EVAL:this.source+="    ; "+a+"\n";break;case l.modes.ESCAPED:this.source+="    ; __append(escapeFn("+k(a)+"))\n";break;case l.modes.RAW:this.source+="    ; __append("+k(a)+")\n";break;case l.modes.COMMENT:break;case l.modes.LITERAL:b()}}else b()}c.opts.compileDebug&&e&&(this.currentLine+=e,this.source+="    ; __line = "+this.currentLine+"\n")}},c.escapeXML=o.escapeXML,c.__express=c.renderFile,a.extensions&&(a.extensions[".ejs"]=function(a,b){var d=b||a.filename,e={filename:d,client:!0},f=g(d).toString(),h=c.compile(f,e);a._compile("module.exports = "+h.toString()+";",d)}),c.VERSION=q,c.name="ejs","undefined"!=typeof window&&(window.ejs=c)},{"../package.json":6,"./utils":2,fs:3,path:4}],2:[function(a,b,c){"use strict";function d(a){return f[a]||a}var e=/[|\\{}()[\]^$+*?.]/g;c.escapeRegExpChars=function(a){return a?String(a).replace(e,"\\$&"):""};var f={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&#34;","'":"&#39;"},g=/[&<>\'"]/g;c.escapeXML=function(a){return void 0==a?"":String(a).replace(g,d)},c.escapeXML.toString=function(){return Function.prototype.toString.call(this)+';\nvar _ENCODE_HTML_RULES = {\n      "&": "&amp;"\n    , "<": "&lt;"\n    , ">": "&gt;"\n    , \'"\': "&#34;"\n    , "\'": "&#39;"\n    }\n  , _MATCH_HTML = /[&<>\'"]/g;\nfunction encode_char(c) {\n  return _ENCODE_HTML_RULES[c] || c;\n};\n'},c.shallowCopy=function(a,b){b=b||{};for(var c in b)a[c]=b[c];return a},c.shallowCopyFromList=function(a,b,c){for(var d=0;d<c.length;d++){var e=c[d];void 0!==b[e]&&(a[e]=b[e])}return a},c.cache={_data:{},set:function(a,b){this._data[a]=b},get:function(a){return this._data[a]},reset:function(){this._data={}}}},{}],3:[function(a,b,c){},{}],4:[function(a,b,c){(function(a){function b(a,b){for(var c=0,d=a.length-1;d>=0;d--){var e=a[d];"."===e?a.splice(d,1):".."===e?(a.splice(d,1),c++):c&&(a.splice(d,1),c--)}if(b)for(;c--;c)a.unshift("..");return a}function d(a,b){if(a.filter)return a.filter(b);for(var c=[],d=0;d<a.length;d++)b(a[d],d,a)&&c.push(a[d]);return c}var e=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,f=function(a){return e.exec(a).slice(1)};c.resolve=function(){for(var c="",e=!1,f=arguments.length-1;f>=-1&&!e;f--){var g=f>=0?arguments[f]:a.cwd();if("string"!=typeof g)throw new TypeError("Arguments to path.resolve must be strings");g&&(c=g+"/"+c,e="/"===g.charAt(0))}return c=b(d(c.split("/"),function(a){return!!a}),!e).join("/"),(e?"/":"")+c||"."},c.normalize=function(a){var e=c.isAbsolute(a),f="/"===g(a,-1);return a=b(d(a.split("/"),function(a){return!!a}),!e).join("/"),a||e||(a="."),a&&f&&(a+="/"),(e?"/":"")+a},c.isAbsolute=function(a){return"/"===a.charAt(0)},c.join=function(){var a=Array.prototype.slice.call(arguments,0);return c.normalize(d(a,function(a,b){if("string"!=typeof a)throw new TypeError("Arguments to path.join must be strings");return a}).join("/"))},c.relative=function(a,b){function d(a){for(var b=0;b<a.length&&""===a[b];b++);for(var c=a.length-1;c>=0&&""===a[c];c--);return b>c?[]:a.slice(b,c-b+1)}a=c.resolve(a).substr(1),b=c.resolve(b).substr(1);for(var e=d(a.split("/")),f=d(b.split("/")),g=Math.min(e.length,f.length),h=g,i=0;i<g;i++)if(e[i]!==f[i]){h=i;break}for(var j=[],i=h;i<e.length;i++)j.push("..");return j=j.concat(f.slice(h)),j.join("/")},c.sep="/",c.delimiter=":",c.dirname=function(a){var b=f(a),c=b[0],d=b[1];return c||d?(d&&(d=d.substr(0,d.length-1)),c+d):"."},c.basename=function(a,b){var c=f(a)[2];return b&&c.substr(-1*b.length)===b&&(c=c.substr(0,c.length-b.length)),c},c.extname=function(a){return f(a)[3]};var g="b"==="ab".substr(-1)?function(a,b,c){return a.substr(b,c)}:function(a,b,c){return b<0&&(b=a.length+b),a.substr(b,c)}}).call(this,a("_process"))},{_process:5}],5:[function(a,b,c){function d(){throw new Error("setTimeout has not been defined")}function e(){throw new Error("clearTimeout has not been defined")}function f(a){if(l===setTimeout)return setTimeout(a,0);if((l===d||!l)&&setTimeout)return l=setTimeout,setTimeout(a,0);try{return l(a,0)}catch(b){try{return l.call(null,a,0)}catch(b){return l.call(this,a,0)}}}function g(a){if(m===clearTimeout)return clearTimeout(a);if((m===e||!m)&&clearTimeout)return m=clearTimeout,clearTimeout(a);try{return m(a)}catch(b){try{return m.call(null,a)}catch(b){return m.call(this,a)}}}function h(){q&&o&&(q=!1,o.length?p=o.concat(p):r=-1,p.length&&i())}function i(){if(!q){var a=f(h);q=!0;for(var b=p.length;b;){for(o=p,p=[];++r<b;)o&&o[r].run();r=-1,b=p.length}o=null,q=!1,g(a)}}function j(a,b){this.fun=a,this.array=b}function k(){}var l,m,n=b.exports={};!function(){try{l="function"==typeof setTimeout?setTimeout:d}catch(a){l=d}try{m="function"==typeof clearTimeout?clearTimeout:e}catch(a){m=e}}();var o,p=[],q=!1,r=-1;n.nextTick=function(a){var b=new Array(arguments.length-1);if(arguments.length>1)for(var c=1;c<arguments.length;c++)b[c-1]=arguments[c];p.push(new j(a,b)),1!==p.length||q||f(i)},j.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=k,n.addListener=k,n.once=k,n.off=k,n.removeListener=k,n.removeAllListeners=k,n.emit=k,n.binding=function(a){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(a){throw new Error("process.chdir is not supported")},n.umask=function(){return 0}},{}],6:[function(a,b,c){b.exports={name:"ejs",description:"Embedded JavaScript templates",keywords:["template","engine","ejs"],version:"2.5.6",author:"Matthew Eernisse <mde@fleegix.org> (http://fleegix.org)",contributors:["Timothy Gu <timothygu99@gmail.com> (https://timothygu.github.io)"],license:"Apache-2.0",main:"./lib/ejs.js",repository:{type:"git",url:"git://github.com/mde/ejs.git"},bugs:"https://github.com/mde/ejs/issues",homepage:"https://github.com/mde/ejs",dependencies:{},devDependencies:{browserify:"^13.0.1",eslint:"^3.0.0","git-directory-deploy":"^1.5.1",istanbul:"~0.4.3",jake:"^8.0.0",jsdoc:"^3.4.0","lru-cache":"^4.0.1",mocha:"^3.0.2","uglify-js":"^2.6.2"},engines:{node:">=0.10.0"},scripts:{test:"mocha",lint:'eslint "**/*.js" Jakefile',coverage:"istanbul cover node_modules/mocha/bin/_mocha",doc:"jake doc",devdoc:"jake doc[dev]"}}},{}]},{},[1])(1)}())}(),function(a,b){var c=angular.element(document).scope(),d=injector.get("modelDataService"),e=injector.get("socketService"),f=injector.get("routeProvider"),g=injector.get("eventTypeProvider"),h=injector.get("windowDisplayService"),i=injector.get("windowManagerService"),j=injector.get("hotkeys"),k=injector.get("armyService"),l=injector.get("villageService"),m=injector.get("$filter");define("TWOverflow/eventQueue",function(){var a={},b={};return b.bind=function(b,c){a.hasOwnProperty(b)||(a[b]=[]),a[b].push(c)},b.trigger=function(b,c){a.hasOwnProperty(b)&&a[b].forEach(function(a){a.apply(this,c)})},b}),define("TWOverflow/utils",["helper/time"],function(a){var b={};return b.randomSeconds=function(a){a=parseInt(a,10);var b=a+a/2,c=a-a/2;return Math.round(Math.random()*(b-c)+c)},b.time2seconds=function(a){return a=a.split(":"),a[0]=60*parseInt(a[0],10)*60,a[1]=60*parseInt(a[1],10),a[2]=parseInt(a[2],10),a.reduce(function(a,b){return a+b})},b.emitNotif=function(a,b){var d="success"===a?g.MESSAGE_SUCCESS:g.MESSAGE_ERROR;c.$broadcast(d,{message:b})},b.genVillageLabel=function(a){return a.name+" ("+a.x+"|"+a.y+")"},b.isValidCoords=function(a){return/\s*\d{2,3}\|\d{2,3}\s*/.test(a)},b.isValidDateTime=function(a){return/^\s*([01][0-9]|2[0-3]):[0-5]\d:[0-5]\d(:\d{1,3})? (0[1-9]|[12][0-9]|3[0-1])\/(0[1-9]|1[0-2])\/\d{4}\s*$/.test(a)},b.fixDate=function(a){var b=a.split(" "),c=b[0],d=b[1].split("/");return c+" "+d[1]+"/"+d[0]+"/"+d[2]},b.guid=function(){return Math.floor(16777216*Math.random()).toString(16)},b.matchesElem=function(a,b){return!!$(a).parents(b).length},b.getTimeFromString=function(a,b){var c=a.trim().split(" "),d=c[0].split(":"),e=c[1].split("/"),f=d[0],g=d[1],h=d[2],i=d[3]||null,j=parseInt(e[0],10)-1,k=e[1],l=e[2],e=new Date(l,j,k,f,g,h,i);return e.getTime()+(b||0)},b.formatDate=function(a,b){return m("readableDateFilter")(a,null,c.GAME_TIMEZONE,c.GAME_TIME_OFFSET,b||"HH:mm:ss dd/MM/yyyy")},b.getTimeOffset=function(){return 1e3*a.gameDate().getTimezoneOffset()*60+c.GAME_TIME_OFFSET},b}),define("TWOverflow/locale",["conf/locale","i18n"],function(a,b){function c(a,b,c){if(!d.hasOwnProperty(a))return console.error("Language for module "+a+" not created");var e=Array.from(arguments).slice(1),g=f[a];return d[a][g].apply(this,e)}var d={},e={},f={},g=a.LANGUAGE.split("_")[0],h=function(a){for(var b in a)return b};return c.create=function(a,c,i){if(d.hasOwnProperty(a))return!1;d[a]={};var j=c.hasOwnProperty(g),k=c.hasOwnProperty(i);e[a]=k?i:h(c),f[a]=j?g:e[a];for(var l in c)d[a][l]=b.create({values:c[l]})},c.change=function(a,b){d[a].hasOwnProperty(b)?f[a]=b:(console.error("Language "+b+" of module "+a+" not created. Selection default ("+e[a]+")"),f[a]=e[a])},c.current=function(a){return f[a]},c.eachLang=function(a,b){var c=d[a];for(var e in c)b(e,c[e]("langName"))},c}),define("TWOverflow/ready",function(){return function(a){var b=document.querySelector("#map");angular.element(b).scope().isInitialized?a():c.$on(g.MAP_INITIALIZED,a)}}),require(["TWOverflow/ready","Lockr","ejs"],function(a,b,e){a(function(){var a=d.getSelectedCharacter();e.delimiter="#",b.prefix=a.getId()+"_twOverflow_",j.add("esc",function(){c.$broadcast(g.WINDOW_CLOSED)},["INPUT","SELECT","TEXTAREA"])})}),require(["TWOverflow/locale"],function(a){a.create("common",{en:{start:"Start",pause:"Pause",paused:"Paused",status:"Status",none:"None",info:"Information",settings:"Settings",others:"Others",villages:"Villages",registers:"Registers",filters:"Filters",add:"Add",waiting:"Waiting",attack:"Attack",support:"Support",relocate:"Transfer",activate:"Activate",deactivate:"Disable",units:"Units",officers:"Officers",origin:"Origin",target:"Target",save:"Save",headquarter:"Headquarters",barracks:"Barracks",tavern:"Tavern",hospital:"Hospital",preceptory:"Hall of Orders",chapel:"Chapel",church:"Church",academy:"Academy",rally_point:"Rally Point",statue:"Statue",market:"Market",timber_camp:"Timber Camp",clay_pit:"Clay Pit",iron_mine:"Iron Mine",farm:"Farm",warehouse:"Warehouse",wall:"Wall",spear:"Spearman",sword:"Swordsman",axe:"Axe Fighter",archer:"Archer",light_cavalry:"Light Cavalry",mounted_archer:"Mounted Archer",heavy_cavalry:"Heavy Cavalry",ram:"Ram",catapult:"Catapult",doppelsoldner:"Berserker",trebuchet:"Trebuchet",snob:"Nobleman",knight:"Paladin"},pt:{start:"Iniciar",pause:"Pausar",paused:"Pausado",status:"Status",none:"Nenhum",info:"Informações",settings:"Configurações",others:"Outros",villages:"Aldeias",registers:"Registros",filters:"Filtros",add:"Adicionar",waiting:"Em espera",attack:"Ataque",support:"Apoio",relocate:"Transferência",activate:"Ativar",deactivate:"Desativar",units:"Unidades",officers:"Oficiais",origin:"Origem",target:"Alvo",save:"Salvar",headquarter:"Edifício Principal",barracks:"Quartel",tavern:"Taverna",hospital:"Hospital",preceptory:"Salão das Ordens",chapel:"Capela",church:"Igreja",academy:"Academia",rally_point:"Ponto de Encontro",statue:"Estátua",market:"Mercado",timber_camp:"Bosque",clay_pit:"Poço de Argila",iron_mine:"Mina de Ferro",farm:"Fazenda",warehouse:"Armazém",wall:"Muralha",spear:"Lanceiro",sword:"Espadachim",axe:"Viking",archer:"Arqueiro",light_cavalry:"Cavalaria Leve",mounted_archer:"Arqueiro Montado",heavy_cavalry:"Cavalaria Pesada",ram:"Aríete",catapult:"Catapulta",doppelsoldner:"Berserker",trebuchet:"Trabuco",snob:"Nobre",knight:"Paladino"}},"en")}),define("TWOverflow/autoDeposit",["TWOverflow/locale","helper/time"],function(a,b){var h=!1,i=!1,j=null,k=null,l=injector.get("resourceDepositService"),m=function(){if(i){var a=n();if(k-b.gameTime()<0)return v(m);if(!q(a)){if(o(a)){var c=p(a);return t(c)}if(r(a)){var c=s(a);return u(c)}}}},n=function(){return d.getSelectedCharacter().getResourceDeposit().getJobs()},o=function(a){for(var b in a)if(1===a[b].state)return!0;return!1},p=function(a){for(var b in a)if(1===a[b].state)return a[b];return!1},q=function(a){for(var b in a)if(0===a[b].state)return!0;return!1},r=function(a){for(var b in a)if(2===a[b].state)return!0;return!1},s=function(a){for(var b in a)if(2===a[b].state)return a[b];return!1},t=function(a){e.emit(f.RESOURCE_DEPOSIT_COLLECT,{job_id:a.id,village_id:d.getSelectedVillage().getId()})},u=function(a){e.emit(f.RESOURCE_DEPOSIT_START_JOB,{job_id:a.id})},v=function(a){e.emit(f.RESOURCE_DEPOSIT_GET_INFO,{},function(b){l.updateJobData(b.jobs),k=1e3*b.time_next_reset,a&&a()})},w={};return w.init=function(){a.create("deposit",{en:{title:"AutoDeposit",description:"Automatic Resource Deposit/Second Village collector.",activated:"Automatic Deposit activated",deactivated:"Automatic Deposit deactivated"},pt:{title:"AutoDeposit",description:"Coletor automático para Depósito de Recursos/Segunda Aldeia.",activated:"Depósito Automático ativado",deactivated:"Depósito Automático desativado"}},"en"),h=!0,c.$on(g.RESOURCE_DEPOSIT_JOB_COLLECTED,m),c.$on(g.RESOURCE_DEPOSIT_JOBS_REROLLED,m)},w.start=function(){i=!0,j=setInterval(m,6e4),v(function(){m()})},w.stop=function(){i=!1,clearInterval(j)},w.isRunning=function(){return i},w.isInitialized=function(){return h},w}),define("TWOverflow/autoDeposit/secondVillage",["TWOverflow/autoDeposit","helper/time"],function(a,b){var h,i,j=!1,k=!1,l=!1,m=null,n=injector.get("secondVillageService"),o=function(){if(!k)return!1;var a=p();return a?(setTimeout(function(){v()},1e3*a.time_completed-Date.now()),!1):q()?r():s()?t():void 0},p=function(){var a=n.getJobInProgress(h);if(a in n.getCollectedJobs(h))return!1;if(!(a in h))return!1;var c=1e3*h[a].time_completed;return b.gameTime()<c&&h[a]},q=function(){var a=n.getJobInProgress(h),b=n.getCollectedJobs(h);return!!a&&!(p()||a in b)},r=function(){var a=n.getJobInProgress(h);e.emit(f.SECOND_VILLAGE_COLLECT_JOB_REWARD,{job_id:h[a].id,village_id:d.getSelectedVillage().getId()},function(){v()})},s=function(){var a=n.getCurrentDayJobs(h,i);for(var b in a)if(!a[b].collected)return!0;return!1},t=function(){var a=n.getCurrentDayJobs(h,i),b=u(a);if(!b)return!1;e.emit(f.SECOND_VILLAGE_START_JOB,{job_id:b.id,village_id:d.getSelectedVillage().getId()},function(){v(),setTimeout(v,1e3*b.duration+3e3)})},u=function(){var a=n.getCurrentDayJobs(h,i),b=n.getCollectedJobs(h),c=d.getSelectedVillage().getResources().getResources(),e=n.getAvailableJobs(a,b,c,[]);for(var f in e)return e[f];return!1},v=function(a){e.emit(f.SECOND_VILLAGE_GET_INFO,{},function(b){h=b.jobs,i=b.day,a&&a()})},w={};w.init=function(){if(j=!0,!n.isFeatureActive())return!1;l=!0,c.$on(g.SECOND_VILLAGE_JOB_COLLECTED,o),c.$on(g.SECOND_VILLAGE_VILLAGE_CREATED,o)},w.start=function(){if(!l)return!1;k=!0,m=setInterval(o,6e4),v(o)},w.stop=function(){if(!l)return!1;k=!1,clearInterval(m)},w.isRunning=function(){return l&&k},w.isInitialized=function(){return j},a.secondVillage=w}),define("TWOverflow/autoDeposit/interface",["TWOverflow/autoDeposit","TWOverflow/FrontButton","TWOverflow/locale","TWOverflow/utils"],function(a,b,c,d){function e(){return f=new b("Deposit",{classHover:!1,classBlur:!1,tooltip:c("deposit","description")}),f.click(function(){a.isRunning()?(a.stop(),a.secondVillage.stop(),f.$elem.removeClass("btn-red").addClass("btn-green"),d.emitNotif("success",c("deposit","deactivated"))):(a.start(),a.secondVillage.start(),f.$elem.removeClass("btn-green").addClass("btn-red"),d.emitNotif("success",c("deposit","activated")))}),f}var f;a.interface=function(){a.interface=e()}}),require(["TWOverflow/ready","TWOverflow/autoDeposit","TWOverflow/autoDeposit/secondVillage","TWOverflow/autoDeposit/interface"],function(a,b){if(b.isInitialized())return!1;a(function(){b.init(),b.secondVillage.init(),b.interface()})}),define("TWOverflow/Queue",["TWOverflow/locale","TWOverflow/utils","TWOverflow/eventQueue","helper/time","helper/math","struct/MapData","conf/conf","Lockr"],function(b,c,g,h,i,j,l,m){var n,o,p=[],q={},r=[],s=[],t=!1,u={selectedVillage:function(a){return a.origin.id===d.getSelectedVillage().getId()},barbarianTarget:function(a){return!a.target.character_id},allowedTypes:function(a,b){return b.allowedTypes[a.type]},attack:function(a){return"attack"!==a.type},support:function(a){return"support"!==a.type},relocate:function(a){return"relocate"!==a.type},textMatch:function(a,b){var c=!0,d=b.textMatch.toLowerCase().split(/\W/),e=[a.origin.name,a.originCoords,a.originCoords,a.origin.character_name||"",a.target.name,a.targetCoords,a.target.character_name||"",a.target.tribe_name||"",a.target.tribe_tag||""];return e=e.join("").toLowerCase(),d.some(function(a){if(a.length&&!e.includes(a))return c=!1,!0}),c}},v=function(a){return n.getWorldId()+"-"+a},w=function(a){return a<h.gameTime()+o},x=function(a){var b={};for(var c in a){var d=a[c];"*"!==d&&0===d||(b[c]=d)}return b},y=function(){p=p.sort(function(a,b){return a.sendTime-b.sendTime})},z=function(a){p.push(a)},A=function(a){q[a.id]=a},B=function(a){r.push(a)},C=function(a){s.push(a)},D=function(){m.set(v("queue-commands"),p)},E=function(){m.set(v("queue-sended"),r)},F=function(){m.set(v("queue-expired"),s)},G=function(){var a=m.get(v("queue-commands"),[],!0);if(a.length)for(var b=0;b<a.length;b++){var c=a[b];h.gameTime()>c.sendTime?J.expireCommand(c):(z(c),A(c))}},H=function(a){var b=d.getVillages(),c=b[a.origin.id];if(!c)return!1;var e=c.unitInfo.units,f={};for(var g in a.units){var h=a.units[g];if("*"===h){if(0===(h=e[g].available))continue}else if(h<0&&(h=e[g].available-Math.abs(h))<0)return!1;f[g]=h}return f},I=function(){setInterval(function(){p.length&&p.some(function(a){if(!w(a.sendTime))return!0;t?J.sendCommand(a):J.expireCommand(a)})},200)},J={};return J.initialized=!1,J.version="1.0.2",J.init=function(){b.create("queue",{en:{title:"CommandQueue",attack:"attack",support:"support",relocate:"transfer",sended:"sended",activated:"activated",deactivated:"disabled",expired:"expired",removed:"removed",added:"added","general.clear":"Clear registers","general.nextCommand":"Next command","info.update":"Update v1.0.1","info.update2":"* Catapults now attack the specified building.","info.active1":"Enable/disable","info.active2":"To the commands be sended, the CommandQueue must be mode enabled! All commands you added will be expired instead of send if disabled.","info.active3":"To enable/disable or hit the button at the bottom of this window.","info.dynamic1":"Dynamic amount of troops","info.dynamic2":"To send the maximum amount of a unit, just place a * (asterisk) instead of specify a number.","info.dynamic3":"To keep a certain amount of troops in the village, you must specify a negative number, so when the command is sended, it will be used the maximum amount of the unit minus the amount you specified.","info.delay1":"Delay to send commands","info.delay2":"If your internet have a response time fast enough, the commands will arrive at the exact moment you specify.","info.delay3":"Depending on the response time of the connection to the game server, the commands may not arrive at the exact moment you specify.","info.delay4":"Make tests before and see how long it takes from the moment you press to send the command and when it actually is sent, so use this difference in time to specify the arrival time of the commands.","info.date1":"Date of arrive","info.date2":"You can specify the milliseconds in the arrival time for a greater precision.","add.basics":"Basic information","add.origin":"Origin coordinates","add.addSelected":"Active village","add.target":"Target coordinates","add.addMapSelected":"Selected village on a map","add.arrive":"Date of arrive","add.out":"Date of out","add.currentDate":"Current date","add.travelTimes":"Travel time","queue.waiting":"Waiting commands","queue.noneAdded":"No command added.","queue.sended":"Commands sent","queue.noneSended":"No command sent.","queue.expired":"Expired commands","queue.noneExpired":"No command expired.","queue.remove":"Remove command form list","queue.filters":"Filter commands","filters.selectedVillage":"Show only commands from the selected village","filters.barbarianTarget":"Show only commands with barbarian villages as target","filters.attack":"Show attacks","filters.support":"Show supports","filters.relocate":"Show transfers","filters.textMatch":"Filter by text...","command.out":"Out","command.timeLeft":"Time remaining","command.arrive":"Arrival","error.noUnitsEnough":"Without the enough units to send the command!","error.origin":"Origin village coordinates invalid!","error.target":"Target village coordinates invalid!","error.noUnits":"No units specified!","error.invalidDate":"Invalid date","error.alreadySent":"This %{type} should have left %{date}","error.originNotExist":"Specified origin village does not exist!","error.targetNotExist":"Specified target village does not exist!","error.noMapSelectedVillage":"No selected village on the map.","error.removeError":"Error removing command."},pt:{title:"CommandQueue",attack:"ataque",support:"apoio",relocate:"transferência",sended:"enviado",activated:"ativado",deactivated:"desativado",expired:"expirado",removed:"removido",added:"adicionado","general.clear":"Limpar registros","general.nextCommand":"Próximo comando","info.update":"Atualização v1.0.1","info.update2":"* Catapultas agora atacam o edifício especificado.",
"info.active1":"Ativar/desativar","info.active2":"Para que os comandos sejam enviados, o CommandQueue precisa estar em modo ativado! Todos os comandos que você adicionou serão expirados ao invés de serem enviados caso esteja desaativado.","info.active3":"Para ativar/desativar apenar o botão Ativar/Desativar no rodapé dessa janela.","info.dynamic1":"Quantidade de tropas dinâmica","info.dynamic2":"Para que seja enviado a quantidade máxima de uma unidade específica você deve colocar um simples * (asterisco) no lugar de um número.","info.dynamic3":"Para poupar uma certa quantidade de tropas na aldeia, você deve especificar um número negativo, assim quando o comando for enviado, será utilizada a quantidade máxima da unidade menos a quantidade que você especificou.","info.delay1":"Delay nos envios","info.delay2":"Se sua internet ter um tempo de resposta rápido o bastante, os comandos chegarão no momento exato que você especificar.","info.delay3":"Dependendo do tempo de resposta da conexão com o servidor do jogo, os comandos podem não chegar no momento exato que você especificou.","info.delay4":"Faça testes antes e veja quanto tempo demora do momento em que você preciona para enviar o comando e quando ele realmente é enviado, então use essa diferença na hora de especificar o horário de chegada dos comandos.","info.date1":"Data de chegada","info.date2":"É possível especificar os milésimos no horário de chegada para uma maior precisão.","add.basics":"Informações básicas","add.origin":"Coordenadas da origem","add.addSelected":"Aldeia ativa","add.target":"Coordenadas do alvo","add.addMapSelected":"Aldeia selecionada no mapa","add.arrive":"Data de chegada","add.out":"Data de saída","add.currentDate":"Data atual","add.travelTimes":"Tempos de viagem","queue.waiting":"Comandos em espera","queue.noneAdded":"Nenhum comando adicionado.","queue.sended":"Comandos enviados","queue.noneSended":"Nenhum comando enviado.","queue.expired":"Comandos expirados","queue.noneExpired":"Nenhum comando expirado.","queue.remove":"Remover comando da lista","queue.filters":"Filtro de comandos","filters.selectedVillage":"Mostrar apenas comandos com origem da aldeia selecionada","filters.barbarianTarget":"Mostrar apenas comandos com aldeias bárbaras como alvo","filters.attack":"Mostrar ataques","filters.support":"Mostrar apoios","filters.relocate":"Mostrar transferências","filters.textMatch":"Filtrar por texto...","command.out":"Saída","command.timeLeft":"Tempo restante","command.arrive":"Chegada","error.noUnitsEnough":"Sem unidades o sulficientes para enviar o comando!","error.origin":"Coordendas da aldeia de origem inválida!","error.target":"Coordendas da aldeia alvo inválida!","error.noUnits":"Nenhuma unidade especificada!","error.invalidDate":"Data inválida","error.alreadySent":"Esse %{type} deveria ter saído %{date}","error.originNotExist":"Aldeia de origem especificada não existe!","error.targetNotExist":"Aldeia alvo especificada não existe!","error.noMapSelectedVillage":"Nenhuma aldeia selecionada no mapa.","error.removeError":"Erro ao remover comando."}},"en"),o=c.getTimeOffset(),n=d.getSelectedCharacter(),J.initialized=!0,r=m.get(v("queue-sended"),[],!0),s=m.get(v("queue-expired"),[],!0),G(),I(),a.addEventListener("beforeunload",function(a){t&&p.length&&(a.returnValue=!0)})},J.sendCommand=function(a){if(a.units=H(a),!a.units)return g.trigger("Queue/error",[b("queue","error.noUnitsEnough")]);e.emit(f.SEND_CUSTOM_ARMY,{start_village:a.origin.id,target_village:a.target.id,type:a.type,units:a.units,icon:0,officers:a.officers,catapult_target:a.catapultTarget}),B(a),E(),J.removeCommand(a,"sended"),g.trigger("Queue/send",[a])},J.expireCommand=function(a){C(a),F(),J.removeCommand(a,"expired")},J.addCommand=function(a){if(!c.isValidCoords(a.origin))return g.trigger("Queue/error",[b("queue","error.origin")]);if(!c.isValidCoords(a.target))return g.trigger("Queue/error",[b("queue","error.target")]);if(!c.isValidDateTime(a.date))return g.trigger("Queue/error",[b("queue","error.invalidDate")]);if(angular.equals(a.units,{}))return g.trigger("Queue/error",[b("queue","error.noUnits")]);a.originCoords=a.origin,a.targetCoords=a.target;var d=new Promise(function(b,c){J.getVillageByCoords(a.origin,function(a){if(a)return b(a);c("error.originNotExist")})}),e=new Promise(function(b,c){J.getVillageByCoords(a.target,function(a){if(a)return b(a);c("error.originNotExist")})}),f=Promise.all([d,e]);f.then(function(d){a.origin=d[0],a.target=d[1],a.units=x(a.units),a.date=c.fixDate(a.date),a.travelTime=J.getTravelTime(a.origin,a.target,a.units,a.type,a.officers);var e=c.getTimeFromString(a.date);if("arrive"===a.dateType?(a.sendTime=e-a.travelTime,a.arriveTime=e):(a.sendTime=e,a.arriveTime=e+a.travelTime),w(a.sendTime))return g.trigger("Queue/error",[b("queue","error.alreadySent",{date:c.formatDate(a.sendTime),type:b("common",a.type)})]);"attack"===a.type&&"supporter"in a.officers&&delete a.officers.supporter;for(var f in a.officers)a.officers[f]=1;a.units.catapult&&"support"!==a.type||(a.catapultTarget=null),a.id=c.guid(),z(a),A(a),y(),D(),g.trigger("Queue/add",[a])}),f.catch(function(a){g.trigger("Queue/error",[b("queue",a)])})},J.removeCommand=function(a,b){delete q[a.id];for(var c=0;c<p.length;c++)if(p[c].id==a.id)return p.splice(c,1),"expired"===b?g.trigger("Queue/expired",[a]):"removed"===b&&g.trigger("Queue/remove",[!0,a,!0]),D();g.trigger("Queue/remove",[!1])},J.clearRegisters=function(){m.set(v("queue-expired"),[]),m.set(v("queue-sended"),[]),s=[],r=[]},J.start=function(){t=!0,g.trigger("Queue/start")},J.stop=function(){t=!1,g.trigger("Queue/stop")},J.isRunning=function(){return t},J.getWaitingCommands=function(){return p},J.getWaitingCommandsObject=function(){return q},J.getSendedCommands=function(){return r},J.getExpiredCommands=function(){return s},J.getTravelTime=function(a,b,c,d,e){var f=!1,g=!b.character_id,h=b.character_id&&b.tribe_id&&b.tribe_id===n.getTribeId();"attack"===d?("supporter"in e&&delete e.supporter,g&&(f=!0)):"support"===d&&(h&&(f=!0),"supporter"in e&&(f=!0));var j={units:c,officers:angular.copy(e)},l=k.calculateTravelTime(j,{barbarian:g,ownTribe:h,officers:e,effects:f},d),m=i.actualDistance(a,b);return 1e3*k.getTravelTimeForDistance(j,l,m,d)},J.getVillageByCoords=function(a,b){var c=a.split("|").map(function(a){return parseInt(a,10)}),d=c[0],e=c[1];if(!j.hasTownDataInChunk(d,e))return j.loadTownDataAsync(d,e,1,1,function(){J.getVillageByCoords(a,b)});var f=j.loadTownData(d,e,1,1,l.MAP_CHUNK_SIZE),g=f[0].data,h=!1;g[d]&&g[d][e]&&(h=g[d][e]),b(h||!1)},J.filterCommands=function(a,b,c){var d=u[a];return(c||p).filter(function(a){return d(a,b)})},J}),define("TWOverflow/Queue/analytics",["TWOverflow/Queue","TWOverflow/eventQueue"],function(a,b){a.analytics=function(){ga("create","UA-92130203-5","auto","CommandQueue");var a=d.getPlayer(),c=a.getSelectedCharacter(),e=[];e.push(c.getName()),e.push(c.getId()),e.push(c.getWorldId()),b.bind("Queue/start",function(){ga("CommandQueue.send","event","behavior","start")}),b.bind("Queue/stop",function(){ga("CommandQueue.send","event","behavior","stop")}),b.bind("Queue/error",function(a){ga("CommandQueue.send","event","commands","error",a)}),b.bind("Queue/send",function(a){ga("CommandQueue.send","event","commands",a.type,e.join("~"))}),b.bind("Queue/add",function(){ga("CommandQueue.send","event","behavior","add",e.join("~"))}),b.bind("Queue/expired",function(){ga("CommandQueue.send","event","commands","expired",e.join("~"))}),b.bind("Queue/remove",function(a,b,c){a&&c&&ga("CommandQueue.send","event","commands","remove")})}}),define("TWOverflow/Queue/interface",["TWOverflow/Queue","TWOverflow/locale","TWOverflow/Interface","TWOverflow/Interface/buttonLink","TWOverflow/FrontButton","TWOverflow/utils","TWOverflow/eventQueue","helper/time","ejs"],function(a,b,e,f,h,i,j,k,l){function n(){F=i.getTimeOffset(),E=Object.keys(K.getBuildings()),C=d.getSelectedCharacter();var c={version:a.version,locale:b,units:za(),officers:P,buildings:E};return o=new e("CommandQueue",{activeTab:"info",template:'<div class="win-content message-list-wrapper searchable-list ng-scope"><header class="win-head"><h2><#= locale("queue", "title") #> <span class="small">v<#= version #></span></h2><ul class="list-btn"><li><a href="#" class="twOverflow-close size-34x34 btn-red icon-26x26-close"></a></li></ul></header><div class="tabs tabs-bg"><div class="tabs-four-col"><div class="tab" tab="info"><div class="tab-inner"><div><a href="#" class="btn-icon btn-orange"><#= locale("common", "info") #></a></div></div></div><div class="tab" tab="add"><div class="tab-inner"><div><a href="#" class="btn-icon btn-orange"><#= locale("common", "add") #></a></div></div></div><div class="tab" tab="queue"><div class="tab-inner"><div><a href="#" class="btn-icon btn-orange"><#= locale("common", "waiting") #></a></div></div></div><div class="tab" tab="log"><div class="tab-inner"><div><a href="#" class="btn-icon btn-orange"><#= locale("common", "registers") #></a></div></div></div></div></div><div class="win-main"><div class="box-paper footer has-footer-upper twOverflow-content-info"><h5 class="twx-section collapse"><#= locale("queue", "info.update") #></h5><div><p><#= locale("queue", "info.update2") #></p></div><h5 class="twx-section collapse"><#= locale("queue", "info.active1") #></h5><div><p><#= locale("queue", "info.active2") #></p><p><#= locale("queue", "info.active3") #></p></div><h5 class="twx-section collapse"><#= locale("queue", "info.dynamic1") #></h5><div><p><#= locale("queue", "info.dynamic2") #></p><p><#= locale("queue", "info.dynamic3") #></p></div><h5 class="twx-section collapse"><#= locale("queue", "info.date1") #></h5><div><p><#= locale("queue", "info.date2") #></p></div></div><div class="box-paper footer has-footer-upper rich-text twOverflow-content-add"><form class="addForm"><h5 class="twx-section collapse"><#= locale("queue", "add.basics") #></h5><div><table class="tbl-border-light tbl-striped"><colgroup><col width="25%"><col></colgroup><tbody><tr><td><span class="ff-cell-fix"><#= locale("queue", "add.origin") #></span></td><td><input data-setting="origin" type="text" class="textfield-border origin" pattern="\\d{2,3}\\|\\d{2,3}" placeholder="000|000" required> <a class="img-link btn btn-orange padded addSelected">&laquo; <#= locale("queue", "add.addSelected") #></a></td></tr><tr><td><span class="ff-cell-fix"><#= locale("queue", "add.target") #></span></td><td><input data-setting="target" type="text" class="textfield-border target" pattern="\\d{2,3}\\|\\d{2,3}" placeholder="000|000" required> <a class="img-link btn btn-orange padded addMapSelected">&laquo; <#= locale("queue", "add.addMapSelected") #></a></td></tr><tr><td><span class="ff-cell-fix"><select data-setting="dateType" class="dateType"><option value="arrive" selected="selected"><#= locale("queue", "add.arrive") #></option><option value="out"><#= locale("queue", "add.out") #></option></select></span></td><td><input data-setting="date" type="text" class="textfield-border date" pattern="\\s*\\d{1,2}:\\d{1,2}:\\d{1,2}(:\\d{1,3})? \\d{1,2}\\/\\d{1,2}\\/\\d{4}\\s*" placeholder="00:00:00:000 00/00/0000" required> <a class="img-link btn btn-orange padded addCurrentDate">&laquo; <#= locale("queue", "add.currentDate") #></a></td></tr></tbody></table><table class="tbl-border-light tbl-units tbl-speed travelTimes" style="display:none"><thead><tr><th colspan="7"><#= locale("queue", "add.travelTimes") #></th></tr></thead><tbody><tr><td class="odd"><div class="unit-wrap"><span class="icon icon-34x34-unit-knight"></span> <span class="icon icon-34x34-unit-light_cavalry"></span> <span class="icon icon-34x34-unit-mounted_archer"></span></div><div class="travelTime box-time-sub-icon"><div class="time-icon icon-20x20-attack"></div><span class="attack" unit="knight"></span></div><div class="travelTime box-time-sub-icon"><div class="time-icon icon-20x20-support"></div><span class="support" unit="knight"></span></div></td><td><div class="unit-wrap"><span class="icon icon-single icon-34x34-unit-heavy_cavalry"></span></div><div class="travelTime"><span class="attack" unit="heavy_cavalry"></span></div><div class="travelTime"><span class="support" unit="heavy_cavalry"></span></div></td><td class="odd"><div class="unit-wrap"><span class="icon icon-34x34-unit-archer"></span> <span class="icon icon-34x34-unit-spear"></span> <span class="icon icon-34x34-unit-axe"></span> <span class="icon icon-34x34-unit-doppelsoldner"></span></div><div class="travelTime"><span class="attack" unit="axe"></span></div><div class="travelTime"><span class="support" unit="axe"></span></div></td><td><div class="unit-wrap"><span class="icon icon-single icon-34x34-unit-sword"></span></div><div class="travelTime"><span class="attack" unit="sword"></span></div><div class="travelTime"><span class="support" unit="sword"></span></div></td><td class="odd"><div class="unit-wrap"><span class="icon icon-34x34-unit-catapult"></span> <span class="icon icon-34x34-unit-ram"></span></div><div class="travelTime"><span class="attack" unit="ram"></span></div><div class="travelTime"><span class="support" unit="ram"></span></div></td><td><div class="unit-wrap"><span class="icon icon-single icon-34x34-unit-snob"></span></div><div class="travelTime"><span class="attack" unit="snob"></span></div><div class="travelTime"><span class="support" unit="snob"></span></div></td><td class="odd"><div class="unit-wrap"><span class="icon icon-single icon-34x34-unit-trebuchet"></span></div><div class="travelTime"><span class="attack" unit="trebuchet"></span></div><div class="travelTime"><span class="support" unit="trebuchet"></span></div></td></tr></tbody></table></div><h5 class="twx-section collapse"><#= locale("common", "units") #></h5><table class="tbl-border-light tbl-striped"><colgroup><col width="50%"><col></colgroup><tbody class="preset-edit"><tr> <# units.forEach(function(unit, i) { #> <# if (i !== 0 && i % 2 === 0) { #> </tr><tr> <# } #> <td class="cell-space-left"><span class="float-left icon-bg-black icon-44x44-unit-<#= unit #>"></span><div class="ff-cell-fix cell-space-44x44"><span><#= locale("common", unit) #></span><input class="unit <#= unit #>" type="text" data-setting="<#= unit #>" placeholder="0"></div></td> <# }) #> <td class="text-center catapult-target" style="display:none"><select data-setting="catapultTarget"> <# buildings.forEach(function(building, i) { #> <# if (building === "headquarter") { #> <option value="headquarter" selected="selected"><#= locale("common", "headquarter") #></option> <# } else { #> <option value="<#= building #>"><#= locale("common", building) #></option> <# } #> <# }) #> </select></td></tr></tbody></table><h5 class="twx-section collapse"><#= locale("common", "officers") #></h5><table class="tbl-border-light tbl-striped officers"><tbody><tr> <# for (var i = 0; i < officers.length; i++) { #> <td><span class="icon-44x44-premium_officer_<#= officers[i] #>"></span><label class="size-34x34 btn-orange icon-26x26-checkbox"><input type="checkbox" data-setting="<#= officers[i] #>"></label></td> <# } #> </tr></tbody></table></form></div><div class="box-paper footer has-footer-upper rich-text twOverflow-content-queue"><h5 class="twx-section collapse"><#= locale("queue", "queue.filters") #></h5><div class="filters"><table class="tbl-border-light"><tbody><tr><td><div data-filter="selectedVillage" class="box-border-dark icon selectedVillage" tooltip="<#= locale("queue", "filters.selectedVillage") #>"><span class="icon-34x34-village-info icon-bg-black"></span></div><div data-filter="barbarianTarget" class="box-border-dark icon barbarianTarget" tooltip="<#= locale("queue", "filters.barbarianTarget") #>"><span class="icon-34x34-barbarian-village icon-bg-black"></span></div><div data-filter="attack" class="box-border-dark icon allowedTypes active" tooltip="<#= locale("queue", "filters.attack") #>"><span class="icon-34x34-attack icon-bg-black"></span></div><div data-filter="support" class="box-border-dark icon allowedTypes active" tooltip="<#= locale("queue", "filters.support") #>"><span class="icon-34x34-support icon-bg-black"></span></div><div data-filter="relocate" class="box-border-dark icon allowedTypes active" tooltip="<#= locale("queue", "filters.relocate") #>"><span class="icon-34x34-relocate icon-bg-black"></span></div><div class="text"><input data-filter="textMatch" type="text" class="box-border-dark textMatch" placeholder="<#= locale("queue", "filters.textMatch") #>"></div></td></tr></tbody></table></div><h5 class="twx-section collapse"><#= locale("queue", "queue.waiting") #></h5><div class="queue"><p class="center nothing"><#= locale("queue", "queue.noneAdded") #></p></div></div><div class="box-paper footer has-footer-upper rich-text twOverflow-content-log"><h5 class="twx-section collapse"><#= locale("queue", "queue.sended") #></h5><div class="sended"><p class="center nothing"><#= locale("queue", "queue.noneSended") #></p></div><h5 class="twx-section collapse"><#= locale("queue", "queue.expired") #></h5><div class="expired"><p class="center nothing"><#= locale("queue", "queue.noneExpired") #></p></div></div></div><footer class="win-foot"><ul class="list-btn list-center buttons"><li class="twOverflow-button-log"><a class="btn-orange btn-border clear"><#= locale("queue", "general.clear") #></a></li><li class="twOverflow-button-add"><a class="btn-orange btn-border add" name="attack"><span class="icon-26x26-attack-small"></span> <#= locale("common", "attack") #></a></li><li class="twOverflow-button-add"><a class="btn-orange btn-border add" name="support"><span class="icon-26x26-support"></span> <#= locale("common", "support") #></a></li><li class="twOverflow-button-add"><a class="btn-orange btn-border add" name="relocate"><span class="icon-26x26-relocate"></span> <#= locale("common", "relocate") #></a></li><li><a class="btn-green btn-border switch"><#= locale("common", "activate") #></a></li></ul></footer></div>',replaces:c,css:'#CommandQueue input[type="text"]{width:50%}#CommandQueue input.unit{width:80px}#CommandQueue form .padded{padding:2px 8px}#CommandQueue .command{margin-bottom:10px}#CommandQueue .command .time-left{width:93px;display:inline-block;padding:0 0 0 3px}#CommandQueue .command .sent-time,#CommandQueue .command .arrive-time{width:160px;display:inline-block;padding:0 0 0 5px}#CommandQueue .command td{padding:3px 6px}#CommandQueue .officers td{width:111px;text-align:center}#CommandQueue .officers label{margin-left:5px}#CommandQueue .officers span{margin-left:2px}#CommandQueue .units div.unit{float:left}#CommandQueue .units div.unit span.icon{zoom:.6}#CommandQueue .units div.unit span.amount{vertical-align:-2px;margin:0 5px 0 2px}#CommandQueue .units div.officer{float:left;margin:0 2px}#CommandQueue .units div.officer span{zoom:.6}#CommandQueue .remove-command{float:right;margin-top:3px}#CommandQueue .tbl-units td{text-align:center}#CommandQueue .travelTimes .travelTime{display:block;color:#1c4b1c}#CommandQueue .travelTimes .travelTime.box-time-sub-icon{position:relative;padding:2px 0 2px 0}#CommandQueue .travelTimes .travelTime.box-time-sub-icon .time-icon{position:absolute;top:0;left:7px}#CommandQueue .dateType{width:95%}#CommandQueue .dateType .custom-select-handler{text-align:left}#CommandQueue .filters .icon{width:38px;float:left;margin:0 6px}#CommandQueue .filters .icon.active:before{box-shadow:0 0 0 1px #000,-1px -1px 0 2px #ac9c44,0 0 0 3px #ac9c44,0 0 0 4px #000;border-radius:1px;content:"";position:absolute;width:38px;height:38px;left:-1px;top:-1px}#CommandQueue .filters .text{margin-left:262px}#CommandQueue .filters .text input{height:36px;margin-top:1px;width:100%;text-align:left;padding:0 5px}#CommandQueue .filters .text input::placeholder{color:white}#CommandQueue .filters .text input:focus::placeholder{color:transparent}#CommandQueue .filters td{padding:6px}#CommandQueue .icon-34x34-barbarian-village:before{filter:grayscale(100%);background-image:url(https://i.imgur.com/ozI4k0h.png);background-position:-220px -906px}#CommandQueue .icon-20x20-time-arrival:before{zoom:.8;background-image:url(https://i.imgur.com/ozI4k0h.png);background-position:-529px -454px}#CommandQueue .icon-20x20-attack:before{zoom:.8;background-image:url(https://i.imgur.com/ozI4k0h.png);background-position:-546px -1086px;width:26px;height:26px}#CommandQueue .icon-20x20-support:before{zoom:.8;background-image:url(https://i.imgur.com/ozI4k0h.png);background-position:-462px -360px;width:26px;height:26px}#CommandQueue .icon-20x20-relocate:before{zoom:.8;background-image:url(https://i.imgur.com/ozI4k0h.png);background-position:-1090px -130px;width:26px;height:26px}#CommandQueue .icon-26x26-attack:before{background-image:url(https://i.imgur.com/ozI4k0h.png);background-position:-546px -1086px}'}),p=new h("Command"),p.hover(function(){var c=a.getWaitingCommands(),d=c.length?i.formatDate(c[0].sendTime):b("common","none"),e=b("queue","general.nextCommand")+": "+d;p.updateQuickview(e)}),p.click(function(){o.openWindow()}),q=$(o.$window),r=q.find("a.switch"),s=q.find("form.addForm"),t=q.find("input.origin"),u=q.find("input.target"),v=q.find("input.date"),w=q.find(".officers input"),$travelTimes=q.find("table.travelTimes"),y=q.find(".dateType"),z=q.find(".filters"),A=q.find("td.catapult-target"),B=q.find("input.unit.catapult"),x={queue:q.find("div.queue"),sended:q.find("div.sended"),expired:q.find("div.expired")},["attack","support"].forEach(function(a){$travelTimes.find("."+a).forEach(function(b){var c=b.getAttribute("unit");G[a][c]=b})}),j.bind("Queue/error",function(a){i.emitNotif("error",a)}),j.bind("Queue/remove",function(a,c){if(!a)return i.emitNotif("error",b("queue","error.removeError"));la(c,"queue"),i.emitNotif("success",wa(c.type,"removed"))}),j.bind("Queue/expired",function(a){la(a,"queue"),ma(a,"expired"),i.emitNotif("error",wa(a.type,"expired"))}),j.bind("Queue/add",function(a){ba(),ra(),i.emitNotif("success",wa(a.type,"added"))}),j.bind("Queue/send",function(a){la(a,"queue"),ma(a,"sended"),i.emitNotif("success",wa(a.type,"sended"))}),j.bind("Queue/start",function(){p.$elem.removeClass("btn-green").addClass("btn-red"),r.removeClass("btn-green").addClass("btn-red"),r.html(b("common","deactivate")),i.emitNotif("success",wa("title","activated"))}),j.bind("Queue/stop",function(){p.$elem.removeClass("btn-red").addClass("btn-green"),r.removeClass("btn-red").addClass("btn-green"),r.html(b("common","activate")),i.emitNotif("success",wa("title","deactivated"))}),setInterval(function(){W()&&fa()},1e3),ta(),ua(),X(),na(),o}var o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G={attack:{},support:{}},H=null,I=null,J={},K=d.getGameData(),L={origin:!1,target:!1,date:!1},M={selectedVillage:!1,barbarianTarget:!1,allowedTypes:!0,attack:!0,support:!0,relocate:!0,textMatch:!0},N=["selectedVillage","barbarianTarget","allowedTypes","textMatch"],O={allowedTypes:{attack:!0,support:!0,relocate:!0},textMatch:""},P=K.getOrderedOfficerNames(),Q=K.getOrderedUnitNames(),R=["knight","heavy_cavalry","axe","sword","ram","snob","trebuchet"],S="arrive",T=!1,U=function(){$travelTimes.css("display","none")},V=function(){$travelTimes.css("display","")},W=function(){return o.isVisible("add")&&L.origin&&L.target&&L.date},X=function(a){_(),Y(),Z(),ra()},Y=function(){a.getSendedCommands().forEach(function(a){ma(a,"sended")})},Z=function(){a.getExpiredCommands().forEach(function(a){ma(a,"expired")})},_=function(){a.getWaitingCommands().forEach(function(a){ma(a,"queue")})},aa=function(){x.queue.find(".command").remove(),J={}},ba=function(){aa(),_()},ca=function(a){return Q.includes(a)},da=function(a){return P.includes(a)},ea=function(){var a=new Date(k.gameTime()+F),b=k.zerofill(a.getMilliseconds(),3),c=k.zerofill(a.getSeconds(),2),d=k.zerofill(a.getMinutes(),2);return k.zerofill(a.getHours(),2)+":"+d+":"+c+":"+b+" "+k.zerofill(a.getDate(),2)+"/"+k.zerofill(a.getMonth()+1,2)+"/"+a.getFullYear()},fa=function(){if(!L.origin||!L.target)return $travelTimes.hide();var b=(t.val(),u.val(),ya());if(L.date)var c=i.fixDate(v.val()),d=i.getTimeFromString(c);["attack","support"].forEach(function(c){R.forEach(function(e){var f={};f[e]=1;var g=a.getTravelTime(H,I,f,c,b),h=m("readableMillisecondsFilter")(g);if("arrive"===S)if(L.date){var i=d-g;xa(i)||(h=ga(h))}else h=ga(h);G[c][e].innerHTML=h})}),V()},ga=function(a){return'<span class="text-red">'+a+"</span>"},ha=function(a){a.css("color","#a1251f")},ia=function(a){a.css("color","")},ja=function(a){q.find("[data-setting]").forEach(function(b){var c=b.dataset.setting;a(b,c)})},ka=function(b){var c={units:{},officers:{},type:b};ja(function(a,b){var d=a.value;if("dateType"===b)c.dateType=a.dataset.value;else if("catapultTarget"===b)c.catapultTarget=a.dataset.value||null;else{if(!d)return!1;ca(b)?c.units[b]=isNaN(d)?d:parseInt(d,10):da(b)?a.checked&&(c.officers[b]=1):d&&(c[b]=d)}}),a.addCommand(c)},la=function(a,b){var c=x[b].find(".command").filter(function(b){return b.dataset.id===a.id});$(c).remove(),pa(a.id),sa(b),o.isVisible("queue")&&o.recalcScrollbar()},ma=function(c,d){var e=document.createElement("div");e.dataset.id=c.id,e.className="command";var g=f("village",i.genVillageLabel(c.origin),c.origin.id),h=f("village",i.genVillageLabel(c.target),c.target.id),j=i.formatDate(c.arriveTime),k=i.formatDate(c.sendTime),m=!!Object.keys(c.officers).length;if(e.innerHTML=l.render('<table class="tbl-border-light"><colgroup><col width="100px"></colgroup><tbody><tr><th colspan="2"> <# if (type === "attack") { #> <span class="icon-bg-red icon-26x26-attack" tooltip="<#= locale("common", "attack") #>"></span> <# } else { #> <span class="icon-bg-blue icon-26x26-support" tooltip="<#= locale("common", "support") #>"></span> <# } #> <# if (section === "queue") { #> <span class="size-26x26 icon-bg-black icon-26x26-time-duration" tooltip="<#= locale("queue", "command.timeLeft") #>"></span> <span class="time-left">00:00:00</span> <# } #> <span class="size-26x26 icon-bg-black icon-20x20-units-outgoing" tooltip="<#= locale("queue", "command.out") #>"></span> <span class="sent-time"><#= sendTime #></span><span class="size-26x26 icon-bg-black icon-20x20-time-arrival" tooltip="<#= locale("queue", "command.arrive") #>"></span> <span class="arrive-time"><#= arriveTime #></span> <# if (section === "queue") { #> <a href="#" class="remove-command size-20x20 btn-red icon-20x20-close" tooltip="<#= locale("queue", "queue.remove") #>"></a> <# } #> </th></tr><tr><td><#= locale("common", "villages") #></td><td><a class="origin"></a> <span class="size-20x20 icon-26x26-<#= type #>"></span> <a class="target"></a></td></tr><tr><td><#= locale("common", "units") #></td><td class="units"> <# for (var unit in units) { #> <div class="unit"> <# if (unit === "catapult" && type === "attack") { #> <span class="icon-34x34-unit-<#= unit #> icon"></span><span class="amount"><#= units[unit] #> <span>(<#= locale("common", catapultTarget) #>)</span></span> <# } else { #> <span class="icon-34x34-unit-<#= unit #> icon"></span><span class="amount"><#= units[unit] #></span> <# } #> </div> <# } #> <# if (hasOfficers) { #> <# for (var officer in officers) { #> <div class="officer"><span class="icon-34x34-premium_officer_<#= officer #>"></span></div> <# } #> <# } #> </td></tr></tbody></table>',{sendTime:k,type:c.type,arriveTime:j,units:c.units,hasOfficers:m,officers:c.officers,section:d,locale:b,catapultTarget:c.catapultTarget}),e.querySelector(".origin").replaceWith(g.elem),e.querySelector(".target").replaceWith(h.elem),"queue"===d){var n=e.querySelector(".remove-command"),p=e.querySelector(".time-left");n.addEventListener("click",function(b){a.removeCommand(c,"removed")}),oa(p,c.id)}x[d].append(e),o.setTooltips(),sa(d)},na=function(){var b=a.getWaitingCommandsObject();setInterval(function(){var a=k.gameTime()+F;if(!o.isVisible("queue"))return!1;for(var c in J){var d=b[c],e=d.sendTime-a;e>0&&(J[c].innerHTML=m("readableMillisecondsFilter")(e,!1,!0))}},1e3)},oa=function(a,b){J[b]=a},pa=function(a){delete J[a]},qa=function(b){var c=a.getWaitingCommandsObject();x.queue.find(".command").forEach(function(a){var d=c[a.dataset.id];d&&b(a,d)})},ra=function(b){var c=a.getWaitingCommands();N.forEach(function(b){M[b]&&(c=a.filterCommands(b,O,c))});var d=c.map(function(a){return a.id});qa(function(a,b){a.style.display=d.includes(b.id)?"":"none"}),o.recalcScrollbar()},sa=function(b){var c=x[b],d=c.find("p.nothing"),e="queue"===b?a.getWaitingCommands():c.find("div");d.css("display",0===e.length?"":"none")},ta=function(){y.on("selectSelected",function(){S=y[0].dataset.value,fa()}),r.on("click",function(b){a.isRunning()?a.stop():a.start()}),q.find(".buttons .add").on("click",function(){ka(this.name)}),q.find("a.clear").on("click",function(){va()}),q.find("a.addSelected").on("click",function(){var a=d.getSelectedVillage().getPosition();t.val(a.x+"|"+a.y),t.trigger("input")}),q.find("a.addMapSelected").on("click",function(){if(!T)return i.emitNotif("error",b("queue","error.noMapSelectedVillage"));u.val(T.join("|")),u.trigger("input")}),q.find("a.addCurrentDate").on("click",function(){v.val(ea()),v.trigger("input")}),t.on("input",function(){if(L.origin=i.isValidCoords(t.val()),fa(),!L.origin)return ha(t);a.getVillageByCoords(t.val(),function(a){!a||a.id<0?(L.origin=!1,U(),ha(t)):(H=a,ia(t))})}),u.on("input",function(){if(L.target=i.isValidCoords(u.val()),!L.target)return ha(u);a.getVillageByCoords(u.val(),function(a){!a||a.id<0?(L.target=!1,ha(u),U()):(I=a,ia(u),fa())})}),v.on("input",function(){L.date=i.isValidDateTime(v.val()),L.date?ia(v):ha(v),fa()}),w.on("change",function(){fa()}),B.on("input",function(a){a.target.value?A.css("display",""):A.css("display","none")}),c.$on(g.SHOW_CONTEXT_MENU,function(a,b){T=[b.data.x,b.data.y]}),c.$on(g.DESTROY_CONTEXT_MENU,function(){T=!1}),c.$on(g.VILLAGE_SELECTED_CHANGED,function(){ra()})},ua=function(){z.find(".selectedVillage").on("click",function(){M.selectedVillage?this.classList.remove("active"):this.classList.add("active"),M.selectedVillage=!M.selectedVillage,ra()}),z.find(".barbarianTarget").on("click",function(){M.barbarianTarget?this.classList.remove("active"):this.classList.add("active"),M.barbarianTarget=!M.barbarianTarget,ra()}),z.find(".allowedTypes").on("click",function(){var a=this.dataset.filter,b=M[a];b?this.classList.remove("active"):this.classList.add("active"),M[a]=!b,O.allowedTypes[a]=!b,ra()}),z.find(".textMatch").on("input",function(a){clearTimeout(D),O[this.dataset.filter]=this.value,D=setTimeout(function(){ra()},250)})},va=function(){a.getSendedCommands().forEach(function(a){la(a,"sended")}),a.getExpiredCommands().forEach(function(a){la(a,"expired")}),a.clearRegisters()},wa=function(a,c,d){return d&&(a=d+"."+a),b("queue",a)+" "+b("queue",c)},xa=function(a){return!(k.gameTime()+F>a)},ya=function(){var a={};return P.forEach(function(b){s.find('[name="'+b+'"]').val()&&(a[b]=!0)}),a},za=function(){var a=Q.filter(function(a){return"catapult"!==a});return a.push("catapult"),a};a.interface=function(){a.interface=n()}}),require(["TWOverflow/ready","TWOverflow/Queue","TWOverflow/Queue/interface","TWOverflow/Queue/analytics"],function(a,b){if(b.initialized)return!1;a(function(){b.init(),b.interface(),b.analytics()})}),define("TWOverflow/Farm",["TWOverflow/locale","TWOverflow/Farm/Village","TWOverflow/utils","TWOverflow/eventQueue","helper/math","conf/conf","struct/MapData","helper/mapconvert","helper/time","conf/locale","Lockr"],function(a,b,h,j,k,l,m,n,o,p,q){var r,s,t,u,v,w=!1,x=/(\(|\{|\[|\"|\')[^\)\}\]\"\']+(\)|\}|\]|\"|\')/,y=null,z=[],A=null,B=null,C={},D=null,E=!0,F=!0,G=[],H=null,I=null,J=null,K=[],L=[],M={},N=!1,O="",P={},Q="paused",R=[function(a){if(a.id<0)return!0},function(a){if(a.character_id===v.getId())return!0},function(a){if(a.attack_protection)return!0},function(a){if(a.character_id){if(!L.includes(a.id))return!0}},function(a){return a.points<qa.settings.minPoints||(a.points>qa.settings.maxPoints||void 0)},function(a){var b=A.position,c=k.actualDistance(b,a);return c<qa.settings.minDistance||(c>qa.settings.maxDistance||void 0)}],S=function(a){
var b={};for(var c in a)a[c]>0&&(b[c]=a[c]);return b},T=function(){q.set("farm-lastEvents",r)},U=function(){var a=d.getGroupList().getGroups();H=qa.settings.groupIgnore in a&&a[qa.settings.groupIgnore],I=qa.settings.groupInclude in a&&a[qa.settings.groupInclude],J=qa.settings.groupOnly in a&&a[qa.settings.groupOnly]},V=function(){var a=d.getGroupList();K=[],L=[],H&&(K=a.getGroupVillageIds(H.id)),I&&(L=a.getGroupVillageIds(I.id))},W=function(){var a=v.getVillageList().map(function(a){return new b(a)}).filter(function(a){return!K.includes(a.id)});if(J){var c=d.getGroupList(),e=c.getGroupVillageIds(J.id);a=a.filter(function(a){return e.includes(a.id)})}if(y=a,B=1===y.length,A=y[0],qa.commander.running&&N)for(var f=0;f<a.length;f++){var g=a[f];if(!M[g.id]){N=!1,qa.commander.analyse();break}}qa.eventQueueTrigger("Farm/villagesUpdate")},X=function(a){var b=function(b){if(G=[],!qa.settings.presetName)return void(a&&a());for(var c in b)if(b.hasOwnProperty(c)){var d=b[c].name,e=d.replace(x,"").trim();e===qa.settings.presetName&&(b[c].cleanName=e,b[c].units=S(b[c].units),G.push(b[c]))}a&&a()};d.getPresetList().isLoaded()?b(d.getPresetList().getPresets()):e.emit(f.GET_PRESETS,{},function(a){qa.eventQueueTrigger("Farm/presetsLoaded"),b(a.presets)})},Y=function(){var a=[],b=function(a){var b=ha(a.target_village_id);return!!b&&(ga(b),!0)},d=function(a){la(a.id,function(a){var b=a.ReportAttack,c=b.attVillageId,d=b.defVillageId;if(P.hasOwnProperty(c)||(P[c]=[]),P[c].includes(d))return!1;P[c].push(d),qa.eventQueueTrigger("Farm/priorityTargetAdded",[{id:d,name:b.defVillageName,x:b.defVillageX,y:b.defVillageY}])})},e=function(){a.forEach(function(a){d(a)}),a=[]},f=function(c,e){if(!qa.commander.running||"attack"!==e.type)return!1;qa.settings.ignoreOnLoss&&1!==e.result&&b(e),qa.settings.priorityTargets&&"full"===e.haul&&(i.isTemplateOpen("report")?a.push(e):d(e))},h=function(a,b){"report"===b&&e()};c.$on(g.REPORT_NEW,f),c.$on(g.WINDOW_CLOSED,h)},Z=function(){var a=function(a,b){var c=qa.settings.remoteId;if(1!==b.participants.length||b.title!==c)return!1;switch(b.message.content.trim().toLowerCase()){case"on":case"start":case"init":case"begin":da(function(){qa.stop(),qa.start()}),ma(b.message_id,na()),qa.eventQueueTrigger("Farm/remoteCommand",["on"]);break;case"off":case"stop":case"pause":case"end":da(function(){qa.stop()}),ma(b.message_id,na()),qa.eventQueueTrigger("Farm/remoteCommand",["off"]);break;case"status":case"current":ma(b.message_id,na()),qa.eventQueueTrigger("Farm/remoteCommand",["status"])}return!1};c.$on(g.MESSAGE_SENT,a)},$=function(){var a=function(){X(),qa.eventQueueTrigger("Farm/presetsChange"),G.length||qa.commander.running&&(qa.eventQueueTrigger("Farm/noPreset"),qa.stop())},b=function(){U(),V(),qa.eventQueueTrigger("Farm/groupsChanged")},d=function(a,b){if(W(),!I)return!1;I.id===b.group_id&&(C={})};c.$on(g.ARMY_PRESET_UPDATE,a),c.$on(g.ARMY_PRESET_DELETED,a),c.$on(g.GROUPS_UPDATED,b),c.$on(g.GROUPS_CREATED,b),c.$on(g.GROUPS_DESTROYED,b),c.$on(g.GROUPS_VILLAGE_LINKED,d),c.$on(g.GROUPS_VILLAGE_UNLINKED,d)},_=function(){var a=function(a,b){var c=b.origin.id;if(M[c]){if(delete M[c],N){if(N=!1,qa.settings.singleCycle)return!1;qa.commander.running&&(ea(c),setTimeout(function(){qa.commander.analyse()},1e4))}return!1}},b=function(){qa.commander.running&&setTimeout(function(){da(function(){qa.stop(),qa.start()})},5e3)};c.$on(g.COMMAND_RETURNED,a),c.$on(g.RECONNECT,b)},aa=function(){j.bind("Farm/sendCommand",function(){ba(),Q="attacking"}),j.bind("Farm/noPreset",function(){Q="paused"}),j.bind("Farm/noUnits",function(){Q="noUnits"}),j.bind("Farm/noUnitsNoCommands",function(){Q="noUnitsNoCommands"}),j.bind("Farm/start",function(){Q="attacking"}),j.bind("Farm/pause",function(){Q="paused"}),j.bind("Farm/startLoadingTargers",function(){Q="loadingTargets"}),j.bind("Farm/endLoadingTargers",function(){Q="analyseTargets"}),j.bind("Farm/commandLimitSingle",function(){Q="commandLimit"}),j.bind("Farm/commandLimitMulti",function(){Q="noVillages"}),j.bind("Farm/singleCycleEnd",function(){Q="singleCycleEnd",F&&qa.settings.singleCycleNotifs&&h.emitNotif("error",a("farm","events.singleCycleEnd"))}),j.bind("Farm/singleCycleEndNoVillages",function(){Q="singleCycleEndNoVillages",F&&h.emitNotif("error",a("farm","events.singleCycleEndNoVillages"))}),j.bind("Farm/singleCycleNext",function(){if(Q="singleCycleNext",F&&qa.settings.singleCycleNotifs){var b=o.gameTime()+qa.cycle.getInterval();h.emitNotif("success",a("farm","events.singleCycleNext",{time:h.formatDate(b)}))}})},ba=function(){t=o.gameTime(),q.set("farm-lastAttack",t)},ca=function(a){E=!1,a(),E=!0},da=function(a){F=!1,a(),F=!0},ea=function(a){var b=y.indexOf(a);return-1!==b&&(A=y[b],!0)},fa=function(a,b){e.emit(f.ASSIGN_PRESETS,{village_id:A.id,preset_ids:a},b)},ga=function(a){if(!H)return!1;e.emit(f.GROUPS_LINK_VILLAGE,{group_id:H.id,village_id:a.id},function(){qa.eventQueueTrigger("Farm/ignoredVillage",[a])})},ha=function(a){for(var b in C)for(var c=C[b],d=0;d<c.length;d++){var e=c[d];if(e.id===a)return e}return!1},ia=function(){M={}},ja=function(){setInterval(function(){if(qa.commander.running){var a=3e5;qa.settings.singleCycle&&qa.cycle.intervalEnabled()&&(a+=qa.cycle.getInterval()+6e4);o.gameTime()-t>a&&da(function(){qa.stop(),qa.start(!0)})}},6e4)},ka=function(){setInterval(function(){C={}},3e5)},la=function(a,b){e.emit(f.REPORT_GET,{id:a},b)},ma=function(a,b){e.emit(f.MESSAGE_REPLY,{message_id:a,message:b})},na=function(){var b=a("common","status"),c=a("farm","events.selectedVillage"),d=a("farm","events.lastAttack"),e={};if("singleCycleNext"===Q){var f=o.gameTime()+qa.cycle.getInterval();e.time=h.formatDate(f)}var g=a("farm","events."+Q,e),i=h.genVillageLabel(A),j=h.formatDate(t),k=A.id,l=[];return l.push("[b]",b,":[/b] ",g,"[br]"),l.push("[b]",c,":[/b] "),l.push("[village=",k,"]",i,"[/village][br]"),l.push("[b]",d,":[/b] ",j),l.join("")},oa=function(){var a=o.gameTime();if(qa.settings.singleCycle&&qa.cycle.intervalEnabled()){if(a>s+qa.cycle.getInterval()+6e4)return!0}else if(a>s+18e5)return!0;return!1},pa=function(){return y.filter(function(a){if(M[a.id])return!1;if(!qa.settings.ignoreFullRes)return!0;var b=a.getResources(),c=a.getMaxStorage();return!["wood","clay","iron"].every(function(a){return b[a]===c})})},qa={};qa.version="3.0.2",qa.init=function(){a.create("farm",{en:{langName:"English",title:"FarmOverflow","events.attacking":"Attacking.","events.commandLimit":"Limit of 50 attacks reached, waiting return.","events.lastAttack":"Last attack","events.nextVillage":"Changing to village %{village}","events.noPreset":"No presets avaliable.","events.noSelectedVillage":"No villages avaliable.","events.noUnits":"No units avaliable in village, waiting attacks return.","events.noUnitsNoCommands":"No villages has units or commands returning.","events.noVillages":"No villages avaliable, waiting attacks return.","events.nothingYet":"Nothing available yet...","events.presetFirst":"Set a preset first!","events.selectedVillage":"Village selected","events.sendCommand":"%{origin} attack %{target}","events.loadingTargets":"Loading targets...","events.checkingTargets":"Checking targets...","events.restartingCommands":"Restarting commands...","events.ignoredVillage":"Target %{target} ignored! (caused loss)","events.priorityTargetAdded":"%{target} added to priorities.","events.analyseTargets":"Analysing targets.","events.singleCycleRestart":"Restarting the cycle of commands..","events.singleCycleEnd":"The list of villages ended, waiting for the next run.","events.singleCycleEndNoVillages":"No village available to start the cycle.","events.singleCycleNext":"The list of villages was over, next cycle: %{time}.","events.singleCycleNextNoVillages":"No village available to start the cycle, next cycle: %{time}.","general.disabled":"— Disabled —","general.paused":"FarmOverflow paused.","general.started":"FarmOverflow started.","info.development1":"Development","info.developedBy":"Developed by","info.notice1":"Notices","info.notice2":"<img src='https://i.imgur.com/ZJtsy1K.png'/> <span style='position:absolute;width:550px;margin:8px 0 0 10px'>Hello native Polish speakers, the polish translation of TWOverflow is 100% but need revision &amp; aprovation, can I borrow some minutes of your time? <br/><br/><a href='https://crowdin.com/project/twoverflow/pl' target='_blank'>https://crowdin.com/project/twoverflow/pl</a></span>","info.groupOnly1":"Using only villages from a group to attack","info.groupOnly2":"You can select a specific group to use only the villages from that group to attack.","info.ignore1":"Ignoring villages from a group","info.ignore2":"You can select ignore targets setting a Ignore Group. All villages that assigned in that group will be ignored by the FarmOverflow. <strong>The group works on targets and your own villages as well</strong>.","info.include1":"Including targets with a group","info.include2":"As well as ignoring villages, you can include village targets of players. Works only in villages inside the maximum distance range.","info.presets1":"Setting presets","info.presets2":"FarmOverflow uses the game's presets that you set up, you just need to select one on the settings tab, save and run to start the farm!","info.presets3":"As the game only allows send presets that is activated on the village. FarmOverflow will activate it automatically if not already activated.","info.presets4":"You can user more than one preset, <strong>since it have the same name</strong> (you can put a small description at the end to help identification)","info.presets5":"See some name exemples for presets:","info.presets6":"Attention with <strong>officers</strong>, they <strong>will be used</strong> if they are activated on the presets.","info.randomBase1":"Random interval base","info.randomBase2":"That interval is a random period of time (in seconds) between each attack avoid the FarmOverflow to be detected by the game. <strong>The bigger the better</strong>.","info.ignoreOnLoss1":"Ignoring targets that cause loss","info.ignoreOnLoss2":"This option will ignore any target that cause loss in your troops.","info.ignoreOnLoss3":"The target that cause any loss to your troops will be ignored in the future.","info.ignoreOnLoss4":'<strong>Note</strong>: For this feature works properly, the option "Ignore villages from group" must be set.',"info.priorityTargets1":"Prioritizing targets","info.priorityTargets2":"When activated, all targets that has full haul reports, will be added to the list of priorities, to resend the attack as soon as possible.","info.remote1":"Controlling remotelly via message","info.remote2":"let the FarmOverflow working in home and control it by the app of game!","info.remote3":'Set the subject of message where you will control the FarmOverflow in the "Settings" tab',"info.remote4":"Create a message and add yourself as a recipient. On the subject put what you set, and in the message use one of the fallowing commands:","info.remote5":"start the farm","info.remote6":"pause the farm","info.remote7":"receive the current status of farm","info.remote8":'If you don\'t receive the message "OK" in return, means that the FarmOverflow did not receive the message or the command was invalid.',"info.remote9":"Attention: Works only if you are the only participant in the message!","info.remote10":"You can use the same message to execute other commands, just reply the message.","settings.basicSettings":"Basic settings","settings.eventsLimit":"Maximum length of task logs","settings.groupIgnore":"Ignore villages from group","settings.groupInclude":"Include targets from group","settings.groupOnly":"Attack only with villages from group","settings.maxDistance":"Targets maximum distance","settings.maxTravelTime":"Maximum travel time (going)","settings.minDistance":"Targets minimum distance","settings.presetName":"Preset of troops","settings.randomBase":"Random interval base (seconds)","settings.ignoreOnLoss":"Add ignored group on targets that cause loss","settings.saved":"Settings saved!","settings.presets":"Presets","settings.security":"Security","settings.minPoints":"Targets minimum points","settings.maxPoints":"Targets maximum points","settings.priorityTargets":"Prioritize targets with full loot report","settings.eventAttack":"Show task logs of attacks","settings.eventVillageChange":"Show task logs of village's changes","settings.eventPriorityAdd":"Show task logs of priority targets","settings.eventIgnoredVillage":"Show task logs of ignored villages","settings.remote":"Control via message (subject)","settings.hotkeySwitch":"Hotkey to start/pause","settings.hotkeyWindow":"Hotkey to open window","settings.singleCycleHeader":"Single cycle options","settings.singleCycle":"Enable single-cycle of attacks","settings.singleCycleInterval":"Interval between cycles","settings.singleCycleNotifs":"Turn on notifications of cycles","settings.maxAttacksPerVillage":"Maximum attacks per village","settings.ignoreFullRes":"Ignore own villages with full resources","tooltip.presets":"Select the preset that will be used to send the attacks.","tooltip.groupIgnore":"Select a group to ignore all villages assigned to it. The group works on targets and your own villages as well.","tooltip.groupInclude":"Select a group to include villages that aren't barbarians only.","tooltip.groupOnly":"Select a group to use only assigned villages to attack.","tooltip.randomBase":"That interval is a random period of time between each attack avoid the FarmOverflow to be detected.","tooltip.priorityTargets":"When activated, all targets that has full haul reports, will be added to the list of priorities, to resend the attack as soon as possible.","tooltip.ignoreOnLoss":"The target that cause any loss to your troops will be ignored in the future. (Only works if you have selected a ignore group)","tooltip.remote":"Set the subject os message that will be used to controll the FarmOverflow remotelly (See the tab Informations to know more).","tooltip.singleCycle":"With the single cycle activated, the FarmOverflow will use only once the villages to attack, as soon as it finish the FarmOverflow will be stopped. You can configure the interval below if you want the cycle to restart after the time specified.","tooltip.singleCycleInterval":"After the cycle ends, a new cycle will start after the specified time. Leave the field empty (0:00:00) If you do not want to reboot cycle.","tooltip.singleCycleNotifs":"A warning notification will be displayed whenever a cycle finish or start.","tooltip.maxAttacksPerVillage":"Reserve some slots of commands in case of emergencies (each village has a limit of 50 commands).","settingError.minDistance":"The target distance must be between %{min} and %{max}.","settingError.maxDistance":"The target distance must be between %{min} and %{max}.","settingError.maxTravelTime":"Maximum travel time format must be hh:mm:ss.","settingError.randomBase":"The random interval base must be between %{min} and %{max}.","settingError.minPoints":"The target pontuation must be a value between %{min} and %{max}.","settingError.maxPoints":"The target pontuation must be a value between %{min} and %{max}.","settingError.eventsLimit":"The amount of events must be a value between %{min} and %{max}.","settingError.singleCycleInterval":"Format of interval between cycles must be hh:mm:ss.","settingError.maxAttacksPerVillage":"The maximum attacks per village must be a value between %{min} and %{max}."},pt:{langName:"Português",title:"FarmOverflow","events.attacking":"Atacando.","events.commandLimit":"Limite de 50 ataques atingido, aguardando retorno.","events.lastAttack":"Último ataque","events.nextVillage":"Alternando para a aldeia %{village}","events.noPreset":"Nenhuma predefinição disponível.","events.noSelectedVillage":"Nenhuma aldeia disponível.","events.noUnits":"Sem unidades na aldeia, aguardando ataques retornarem.","events.noUnitsNoCommands":"Nenhuma aldeia tem tropas nem ataques retornando.","events.noVillages":"Nenhuma aldeia disponível, aguardando ataques retornarem.","events.nothingYet":"Nada por aqui ainda...","events.presetFirst":"Configure uma predefinição primeiro!","events.selectedVillage":"Aldeia selecionada","events.sendCommand":"%{origin} ataca %{target}","events.loadingTargets":"Carregando alvos...","events.checkingTargets":"Checando alvos...","events.restartingCommands":"Reiniciando comandos...","events.ignoredVillage":"Alvo %{target} ignorado! (causou baixas)","events.priorityTargetAdded":"%{target} adicionado as prioridades.","events.analyseTargets":"Analisando alvos.","events.singleCycleRestart":"Reiniciando o ciclo de comandos..","events.singleCycleEnd":"A lista de aldeias acabou, esperando próxima execução.","events.singleCycleEndNoVillages":"Nenhuma aldeia disponível para iniciar o ciclo.","events.singleCycleNext":"A lista de aldeias acabou, próximo ciclo: %{time}.","events.singleCycleNextNoVillages":"Nenhuma aldeia disponível para iniciar o ciclo, próximo ciclo: %{time}.","general.disabled":"— Desativado —","general.paused":"FarmOverflow pausado.","general.started":"FarmOverflow iniciado.","info.development1":"Desenvolvimento","info.developedBy":"Desenvolvido por","info.notice1":"Avisos","info.notice2":"O FarmOverflow atingiu a marca de <b>100.000</b> ataques enviados diariamente, obrigado a todos.","info.groupOnly1":"Usando apenas aldeias de um grupo para atacar","info.groupOnly2":"Você pode selecionar um grupo especifico para usar apenas as aldeias desse grupo para enviar os ataques.","info.ignore1":"Ignorando aldeias com grupo","info.ignore2":"Você pode selecionar um grupo nas configurações para que todas aldeias atribuidas a esse grupo sejam ignorados pelo FarmOverflow. <strong>O grupo serve tanto para os alvos quanto para suas aldeias</strong>.","info.include1":"Incluindo alvos com grupo","info.include2":"Assim como ignorar aldeias, você pode incluir como alvos aldeias de jogadores. Todas aldeias do grupo que estiverem fora da distância máxima não seram incluidas.","info.presets1":"Configurando predefinições","info.presets2":"O FarmOverflow utiliza as próprias predefinições do jogo configuradas por você, basta selecionar uma na aba configurações, salvar e iniciar!","info.presets3":"Como o jogo só permite enviar predefinições que estejam ativas na aldeia, o FarmOverflow irá ativa-las automaticamente caso já não estejam.","info.presets4":"Você pode usar mais de uma predefinição, <strong>desde que tenham o mesmo nome</strong> (você pode adicionar uma pequena descrição na frente do nome para identifica-las melhor).","info.presets5":"Veja alguns exemplos para os nomes das predefinições:","info.presets6":"Atenção com os <strong>oficiais</strong>, eles <strong>serão utilizados</strong> caso estejam ativos nas predefinições.","info.randomBase1":"Base do intervalo aleatório","info.randomBase2":"Esse intervalo é usado para gerar um tempo aleatório (em segundos) entre cada ataque evitando o FarmOverflow ser detectado. <strong>Quanto maior melhor</strong>.","info.ignoreOnLoss1":"Ignorando alvos que causam perdas","info.ignoreOnLoss2":"Qualquer ataque que tenha causado alguma perca nas suas tropas será ignorado em ataques futuros.","info.ignoreOnLoss3":'<strong>Atenção</strong>: Para essa funcionalidade funcionar é preciso ter a opção "Ignorando aldeias com grupo" configurada.',"info.ignoreOnLoss4":'Todas aldeias que forem ignoradas será avisado na aba "Avisos".',"info.priorityTargets1":"Priorizando alvos","info.priorityTargets2":"Quando ativada, todos os alvos que tiverem relatórios com saque no máximo, serão adicionados na lista de prioridades para reenviar o ataque assim que possível.","info.remote1":"Controlando remotamente via mensagem","info.remote2":"Deixe o FarmOverflow funcionando em casa e o controle pelo app do jogo!","info.remote3":'Configure o assunto da mensagem por onde você controlará o FarmOverflow na aba "Configurações"',"info.remote4":"Crie uma mensagem e adicione você mesmo como destinatário. No assunto coloque o que você configurou e no corpo da mensagem use um dos seguintes comandos:","info.remote5":"inicia o farm","info.remote6":"pausa o farm","info.remote7":"recebe o status atual do farm","info.remote8":"Se você não receber uma mensagem de OK em retorno, quer dizer que o FarmOverflow não recebeu a mensagem ou que um comando inválido foi usado.","info.remote9":"Atenção: Só funciona se você for o único participante da mensagem!","info.remote10":"Você pode usar a mesma mensagem para executar outros comandos, bastando responde-la.","settings.basicSettings":"Configurações básicas","settings.eventsLimit":"Número máximo de registros","settings.groupIgnore":"Ignorar aldeias do grupo","settings.groupInclude":"Incluir alvos do grupo","settings.groupOnly":"Atacar apenas com aldeias do grupo","settings.maxDistance":"Distância máxima dos alvos","settings.maxTravelTime":"Tempo máximo de viagem","settings.minDistance":"Distância mínima dos alvos","settings.presetName":"Predefinição das tropas","settings.randomBase":"Intervalo entre cada ataque","settings.ignoreOnLoss":"Ignorar em alvos que causarem perdas","settings.saved":"Configurações salvas!","settings.presets":"Predefinições","settings.security":"Segurança","settings.minPoints":"Pontuação mínima dos alvos","settings.maxPoints":"Pontuação máxima dos alvos","settings.priorityTargets":"Priorizar alvos com de saque lotado","settings.eventAttack":"Mostrar registros de ataques","settings.eventVillageChange":"Mostrar registros de troca de aldeias","settings.eventPriorityAdd":"Mostrar registros de alvos prioritarios","settings.eventIgnoredVillage":"Mostrar registros de aldeias ignoradas","settings.remote":"Controle via mensagem (assunto)","settings.hotkeySwitch":"Tecla de atalho para inicar/pausar","settings.hotkeyWindow":"Tecla de atalho para abrir janela","settings.singleCycleHeader":"Opções de ciclo único","settings.singleCycle":"Ativar ciclo único de ataques","settings.singleCycleInterval":"Intervalo entre os ciclos","settings.singleCycleNotifs":"Ativar notificações dos ciclos","settings.maxAttacksPerVillage":"Máximo de ataques por aldeia","settings.ignoreFullRes":"Ignorar próprias aldeias com recursos lotados","tooltip.presets":"Selecione a predefinição que será usada para enviar os ataques.","tooltip.groupIgnore":"Selecione um grupo para que todas aldeias atribuidas a esse grupo sejam ignoradas. Tanto suas aldeias quanto alvos.","tooltip.groupInclude":"Selecione um grupo para incluir alvos que não sejam apenas aldeias bárbaras.","tooltip.groupOnly":"Selecione um grupo para que apenas as aldeias desse grupo sejam usadas para enviar os ataques.","tooltip.randomBase":"Esse intervalo é usado para gerar um tempo aleatório entre cada ataque evitando o FarmOverflow de ser detectado. O valor é em segundos.","tooltip.priorityTargets":"Quando ativada, todos os alvos que tiverem relatórios com saque no máximo, serão adicionados na lista de prioridades para reenviar o ataque assim que possível.","tooltip.ignoreOnLoss":"Qualquer ataque que tenha causado alguma perca nas suas tropas será ignorado em ataques futuros. (Só funciona quando um grupo de ignorados está selecionado)","tooltip.remote":"Configure o título da mensagem pela qual você deseja controlar o FarmOverflow remotamente (Veja a aba Informações para saber mais).","tooltip.singleCycle":"Com o ciclo único ativado, o FarmOverflow irá usar apenas uma vez as aldeias para atacar, assim que acabar o FarmOverflow será parado. Você pode configurar o intervalo abaixo se quiser que ele reinicie após o tempo especificado.","tooltip.singleCycleInterval":"Após o ciclo terminar, um novo ciclo inicirá após o tempo especificado. Deixe o campo vazio (0:00:00) se não quiser que o ciclo se reinicie.","tooltip.singleCycleNotifs":"Será mostrada uma notificação de aviso sempre que um ciclo terminar ou iniciar.","tooltip.maxAttacksPerVillage":"Reserve alguns slots de comandos para casos de emergência (cada aldeia tem um limite de 50 ataques).","settingError.minDistance":"A distância deve ser um valor entre %{min} e %{max}.","settingError.maxDistance":"A distância deve ser um valor entre %{min} e %{max}.","settingError.maxTravelTime":"O formato do tempo máximo de viagem deve ser hh:mm:ss.","settingError.randomBase":"O intervalo entre cada ataque deve ser um valor entre %{min} e %{max}.","settingError.minPoints":"A pontuação do alvo deve ser entre %{min} e %{max}.","settingError.maxPoints":"A pontuação do alvo deve ser entre %{min} e %{max}.","settingError.eventsLimit":"O número de eventos deve ser entre %{min} e %{max}.","settingError.singleCycleInterval":"O formato do intervalo entre ataques deve ser hh:mm:ss.","settingError.maxAttacksPerVillage":"A quantidade máximo de ataques por aldeia deve ser um valor entre %{min} e %{max}."}},"en"),w=!0;var b=q.get("farm-settings",{},!0);qa.settingsMap={maxDistance:{default:10,updates:["targets"],inputType:"text",min:0,max:50},minDistance:{default:0,updates:["targets"],inputType:"text",min:0,max:50},maxTravelTime:{default:"01:00:00",updates:[],inputType:"text",pattern:/\d{1,2}\:\d{2}\:\d{2}/},randomBase:{default:3,updates:[],inputType:"text",min:0,max:9999},presetName:{default:"",updates:["preset"],inputType:"select"},groupIgnore:{default:"",updates:["groups"],inputType:"select"},groupInclude:{default:"",updates:["groups","targets"],inputType:"select"},groupOnly:{default:"",updates:["groups","villages","targets"],inputType:"select"},minPoints:{default:0,updates:["targets"],inputType:"text",min:0,max:13e3},maxPoints:{default:12500,updates:["targets"],inputType:"text",min:0,max:13e3},eventsLimit:{default:20,updates:["events"],inputType:"text",min:0,max:150},ignoreOnLoss:{default:!0,updates:[],inputType:"checkbox"},priorityTargets:{default:!0,updates:[],inputType:"checkbox"},eventAttack:{default:!0,updates:["events"],inputType:"checkbox"},eventVillageChange:{default:!0,updates:["events"],inputType:"checkbox"},eventPriorityAdd:{default:!0,updates:["events"],inputType:"checkbox"},eventIgnoredVillage:{default:!0,updates:["events"],inputType:"checkbox"},remoteId:{default:"remote",updates:[],inputType:"text"},hotkeySwitch:{default:"shift+z",updates:[],inputType:"text"},hotkeyWindow:{default:"z",updates:[],inputType:"text"},singleCycle:{default:!1,updates:["villages"],inputType:"checkbox"},singleCycleNotifs:{default:!1,updates:[],inputType:"checkbox"},singleCycleInterval:{default:"00:00:00",updates:[],inputType:"text",pattern:/\d{1,2}\:\d{2}\:\d{2}/},maxAttacksPerVillage:{default:48,updates:[],inputType:"text",min:1,max:50},ignoreFullRes:{default:!0,updates:["villages"],inputType:"checkbox"}},qa.settings={};for(var c in qa.settingsMap){var g=qa.settingsMap[c].default;qa.settings[c]=b.hasOwnProperty(c)?b[c]:g}qa.commander=qa.createCommander(),r=q.get("farm-lastEvents",[],!0),s=q.get("farm-lastActivity",o.gameTime(),!0),t=q.get("farm-lastAttack",-1,!0),u=q.get("farm-indexes",{},!0),v=d.getSelectedCharacter(),U(),V(),W(),X(),Y(),Z(),$(),_(),aa(),ja(),ka(),m.setRequestFn(function(a){e.emit(f.MAP_GETVILLAGES,a)})},qa.start=function(b){return G.length?A?(oa()&&(P={},u={}),qa.settings.singleCycle?qa.cycle.start(b):ra(),qa.updateActivity(),!0):(!b&&F&&h.emitNotif("error",a("farm","events.noSelectedVillage")),!1):(!b&&F&&h.emitNotif("error",a("farm","events.presetFirst")),!1)},qa.stop=function(){return clearTimeout(qa.commander.timeoutId),clearTimeout(qa.cycle.getTimeoutId()),qa.commander.running=!1,qa.eventQueueTrigger("Farm/pause"),F&&h.emitNotif("success",a("common","paused")),!0},qa.switch=function(){qa.commander.running?qa.stop():qa.start()},qa.updateActivity=function(){s=o.gameTime(),q.set("farm-lastActivity",s)},qa.updateSettings=function(a){var b={};for(var c in a){var d=qa.settingsMap[c],e=a[c];if(d&&e!==qa.settings[c]){if(d.hasOwnProperty("pattern")){if(!d.pattern.test(e))return qa.eventQueueTrigger("Farm/settingError",[c]),!1}else if(d.hasOwnProperty("min")&&(e<d.min||e>d.max))return qa.eventQueueTrigger("Farm/settingError",[c,{min:d.min,max:d.max}]),!1;d.updates.forEach(function(a){b[a]=!0}),qa.settings[c]=e}}return q.set("farm-settings",qa.settings),b.groups&&(U(),V()),b.villages&&W(),b.preset&&(X(),ia()),b.targets&&(C={}),b.events&&qa.eventQueueTrigger("Farm/resetEvents"),qa.commander.running&&ca(function(){da(function(){qa.stop(),qa.start()})}),qa.eventQueueTrigger("Farm/settingsChange",[b]),!0},qa.nextTarget=function(a){var b=A.id;if(!C[b])return qa.commander.analyse(),!1;var c=C[b];if(qa.settings.priorityTargets&&P[b])for(var d;d=P[b].shift();)if(!K.includes(d))for(var e=0;e<c.length;e++)if(c[e].id===d)return D=c[e],!0;var f=u[b],g=!1;for(a||(f=++u[b]);f<c.length;f++){var h=c[f];{if(!K.includes(h.id)){D=h,g=!0;break}qa.eventQueueTrigger("Farm/ignoredTarget",[h])}}return g?u[b]=f:(D=c[0],u[b]=0),q.set("farm-indexes",u),!0},qa.hasTarget=function(){var a=A.id,b=u[a],c=C[a];return!!c.length&&((void 0===b||b>c.length)&&(u[a]=b=0),!!c[b])},qa.getTargets=function(a){var b=A.position,c=A.id;if(c in C)return a();var d=[],e=l.MAP_CHUNK_SIZE,f=b.x-e,g=b.y-e,h=2*e,i=2*e,j=function(){for(var a=m.loadTownData(f,g,h,i,e),b=a.length;b--;){var c=a[b],j=c.data;for(var k in j){var l=j[k];for(var n in l){var q=l[n],r=o(q);r&&d.push(r)}}}p()},o=function(a){return!!R.every(function(b){return!b(a)})&&{x:a.x,y:a.y,distance:k.actualDistance(b,a),id:a.id,name:a.name,pid:a.character_id}},p=function(){if(0===d.length){return qa.nextVillage()?qa.getTargets(a):qa.eventQueueTrigger("Farm/noTargets"),!1}C[c]=d.sort(function(a,b){return a.distance-b.distance}),u.hasOwnProperty(c)?u[c]>C[c].length&&(u[c]=0,q.set("farm-indexes",u)):(u[c]=0,q.set("farm-indexes",u)),a()};return function(){if(m.hasTownDataInChunk(f,g))j();else{qa.eventQueueTrigger("Farm/startLoadingTargers");var a=n.scaledGridCoordinates(f,g,h,i,e),b=a.length,c=0;m.loadTownDataAsync(f,g,h,i,function(){++c===b&&(qa.eventQueueTrigger("Farm/endLoadingTargers"),j())})}}()};var ra=function(){if(qa.commander=qa.createCommander(),qa.commander.running=!0,qa.eventQueueTrigger("Farm/start"),F&&h.emitNotif("success",a("farm","general.started")),0===pa().length)return void(B?qa.eventQueueTrigger("Farm/noUnits"):qa.eventQueueTrigger("Farm/noVillages"));z=pa(),qa.commander.analyse()};return qa.nextVillage=function(){if(B)return!1;if(qa.settings.singleCycle)return qa.cycle.nextVillage();var a=z.shift();if(a){return pa().some(function(b){return b.id===a.id})?(A=a,qa.eventQueueTrigger("Farm/nextVillage",[A]),qa.updateActivity(),!0):qa.nextVillage()}return z=pa(),z.length?qa.nextVillage():(B?qa.eventQueueTrigger("Farm/noUnits"):qa.eventQueueTrigger("Farm/noVillages"),!1)},qa.checkPresets=function(a){if(!G.length)return qa.stop(),qa.eventQueueTrigger("Farm/noPreset"),!1;var b=A.id,c=d.getPresetList().getPresetsByVillageId(b),e=!1,f=[];if(G.forEach(function(a){c.hasOwnProperty(a.id)||(e=!0,f.push(a.id))}),e){for(var g in c)f.push(g);fa(f,a)}else a()},qa.targetsLoaded=function(){return C.hasOwnProperty(A.id)},qa.hasVillage=function(){return!!A},qa.isWaiting=function(){return M.hasOwnProperty(A.id)},qa.isIgnored=function(){return K.includes(A.id)},qa.isAllWaiting=function(){for(var a=0;a<y.length;a++){var b=y[a].id;if(!M.hasOwnProperty(b))return!1}return!0},qa.setLastEvents=function(a){r=a,T()},qa.getLastEvents=function(){return r},qa.getSelectedVillage=function(){return A},qa.isSingleVillage=function(){return B},qa.getSelectedTarget=function(){return D},qa.isNotifsEnabled=function(){return F},qa.getSelectedPresets=function(){return G},qa.setWaitingVillages=function(a){M[a]=!0},qa.getWaitingVillages=function(){return M},qa.setGlobalWaiting=function(){N=!0},qa.getGlobalWaiting=function(){return N},qa.getLastError=function(){return O},qa.setLastError=function(a){O=a},qa.isInitialized=function(){return w},qa.getLastAttack=function(){return t},qa.createCommander=function(){return new(require("TWOverflow/Farm/Commander"))},qa.setSelectedVillage=function(a){A=a},qa.eventQueueTrigger=function(a,b){E&&j.trigger(a,b)},qa.getFreeVillages=pa,qa.disableNotifs=da,qa}),
define("TWOverflow/Farm/analytics",["TWOverflow/Farm","TWOverflow/eventQueue","Lockr"],function(a,b,c){a.analytics=function(){ga("create","UA-92130203-4","auto","FarmOverflow");var a=d.getPlayer(),e=a.getSelectedCharacter(),f=[];f.push(e.getName()),f.push(e.getId()),f.push(e.getWorldId()),b.bind("Farm/start",function(){ga("FarmOverflow.send","event","behavior","start")}),b.bind("Farm/pause",function(){ga("FarmOverflow.send","event","behavior","pause")}),b.bind("Farm/sendCommandError",function(a){ga("FarmOverflow.send","event","commands","attackError",a)}),b.bind("Farm/ignoredVillage",function(){ga("FarmOverflow.send","event","commands","ignoreTarget")}),b.bind("Farm/priorityTargetAdded",function(){ga("FarmOverflow.send","event","commands","priorityTarget")}),b.bind("Farm/settingsChange",function(a){var b=JSON.stringify(c.get("farm-settings"));ga("FarmOverflow.send","event","behavior","settingsChange",f.concat(b).join("~"))}),b.bind("Farm/remoteCommand",function(a){ga("FarmOverflow.send","event","behavior","remoteCommand",a)}),b.bind("Farm/nextVillage",function(a){ga("FarmOverflow.send","event","behavior","villageChange",a.id)}),b.bind("Farm/sendCommand",function(){ga("FarmOverflow.send","event","commands","attack",f.join("~"))})}}),define("TWOverflow/Farm/Commander",["TWOverflow/Farm","TWOverflow/utils","helper/math"],function(a,b,d){function h(){return this.preventNextCommand=!1,this.timeoutId=null,this.running=!1,this}return h.prototype.analyse=function(){var b=this;if(b.running){if(!a.getSelectedPresets().length)return a.stop(),void a.eventQueueTrigger("Farm/noPreset");if(!a.hasVillage())return a.eventQueueTrigger("Farm/noVillageSelected");var c=a.getSelectedVillage();if(!c.loaded())return void c.load(function(){b.analyse()});if(a.isWaiting()||a.isIgnored())return void(a.nextVillage()?b.analyse():a.eventQueueTrigger(a.getLastError()));if(!a.targetsLoaded())return a.getTargets(function(){b.analyse()});if(!a.hasTarget())return void(a.nextVillage()?b.analyse():a.eventQueueTrigger("Farm/noTargets"));a.nextTarget(!0),a.checkPresets(function(){if(c.countCommands()>=a.settings.maxAttacksPerVillage)return b.handleError("commandLimit");var d=b.getPreset();if(d.error)return b.handleError(d.error);b.getPresetNext(d),b.send(d)})}},h.prototype.handleError=function(b){a.setLastError(b||this.preventNextCommand),this.preventNextCommand=!1;var c=a.getSelectedVillage(),d=c.id;switch(a.getLastError()){case"timeLimit":a.nextTarget(),this.analyse();break;case"noUnits":if(a.eventQueueTrigger("Farm/noUnits",[c]),a.setWaitingVillages(d),a.isSingleVillage())return void(0===c.countCommands()?a.eventQueueTrigger("Farm/noUnitsNoCommands"):(a.setGlobalWaiting(),a.settings.singleCycle&&a.cycle.end()));a.nextVillage()?this.analyse():a.setGlobalWaiting();break;case"commandLimit":if(a.setWaitingVillages(d),a.isSingleVillage())return a.setGlobalWaiting(),a.settings.singleCycle?a.cycle.end():a.eventQueueTrigger("Farm/commandLimitSingle",[c]);if(a.isAllWaiting())return a.eventQueueTrigger("Farm/commandLimitMulti",[c]),a.setGlobalWaiting();a.nextVillage(),this.analyse()}},h.prototype.getPreset=function(b){for(var c=!1,d=b||a.getSelectedVillage().units,e=a.getSelectedPresets(),f=0;f<e.length;f++){var g=e[f],h=!0;for(var i in g.units)d[i].in_town<g.units[i]&&(h=!1);if(h){if(this.checkPresetTime(g))return g;c=!0}else;}return{error:c?"timeLimit":"noUnits"}},h.prototype.getPresetNext=function(b){var c=angular.copy(a.getSelectedVillage().units),d=b.units;for(var e in d)c[e].in_town-=d[e];var f=this.getPreset(c);f.error&&(this.preventNextCommand=f.error)},h.prototype.checkPresetTime=function(c){var e=a.getSelectedTarget(),f=k.calculateTravelTime(c,{barbarian:!e.pid,officers:!1}),g=a.getSelectedVillage().position,h={x:e.x,y:e.y},i=d.actualDistance(g,h),j=k.getTravelTimeForDistance(c,f,i,"attack");return b.time2seconds(a.settings.maxTravelTime)>j},h.prototype.send=function(c,d){if(!this.running)return!1;var g,h,i=this,j=a.getSelectedVillage();return i.simulate(),g=i.onCommandError(function(){h(),j.updateCommands(function(){i.analyse()})}),h=i.onCommandSend(function(){g(),a.nextTarget();var c;c=b.randomSeconds(a.settings.randomBase),c=1e3+1e3*c,i.timeoutId=setTimeout(function(){if(i.preventNextCommand)return i.handleError();i.analyse()},c),a.updateActivity()}),e.emit(f.SEND_PRESET,{start_village:j.id,target_village:a.getSelectedTarget().id,army_preset_id:c.id,type:"attack"}),!0},h.prototype.onCommandSend=function(b){var d=a.getSelectedVillage(),e=angular.copy(d.units),f=c.$on(g.VILLAGE_UNIT_INFO,function(c,g){if(d.id!==g.village_id)return!1;var h=d.units;if(angular.equals(e,h))return!1;a.eventQueueTrigger("Farm/sendCommand",[d,a.getSelectedTarget()]),f(),b()});return f},h.prototype.onCommandError=function(b){var d=c.$on(g.MESSAGE_ERROR,function(c,e){return!(!e.cause||!e.code)&&("Command/sendPreset"===e.cause&&("Command/attackLimitExceeded"===e.code&&(a.eventQueueTrigger("Farm/sendCommandError",[e.code]),d(),void b())))});return d},h.prototype.simulate=function(b){!function(){e.emit(f.GET_ATTACKING_FACTOR,{target_id:a.getSelectedTarget().id})}(),b&&b()},h}),define("TWOverflow/Farm/singleCycle",["TWOverflow/Farm","TWOverflow/locale","TWOverflow/utils","TWOverflow/eventQueue"],function(a,b,c,d){var e=[],f=null,g={};g.intervalEnabled=function(){return!!g.getInterval()},g.start=function(f){a.commander=a.createCommander(),a.commander.running=!0,a.disableNotifs(function(){a.eventQueueTrigger("Farm/start")});var h=a.getFreeVillages();if(0===h.length)return void(g.intervalEnabled()?(a.eventQueueTrigger("Farm/singleCycleNextNoVillages"),g.setNextCycle()):(a.eventQueueTrigger("Farm/singleCycleEndNoVillages"),a.disableNotifs(function(){a.stop()})));f?d.bind("Farm/singleCycleRestart"):a.isNotifsEnabled()&&c.emitNotif("success",b("farm","general.started")),e=h,a.commander.analyse()},g.end=function(){return g.intervalEnabled()?(a.eventQueueTrigger("Farm/singleCycleNext"),g.setNextCycle()):(a.eventQueueTrigger("Farm/singleCycleEnd"),a.disableNotifs(function(){a.stop()})),!1},g.setNextCycle=function(){var a=g.getInterval();f=setTimeout(function(){g.start(!0)},a)},g.nextVillage=function(){var b=e.shift();return b?a.getFreeVillages().some(function(a){return a.id===b.id})?(a.setSelectedVillage(b),a.eventQueueTrigger("Farm/nextVillage",[b]),!0):g.nextVillage():g.end()},g.getInterval=function(){var b=a.settings.singleCycleInterval,c=!1;return!!b&&(b=b.split(/\:/g).map(function(a){return isNaN(c)&&(c=!0),parseInt(a,10)}),!c&&(b=1e3*b[0]*60*60+1e3*b[1]*60+1e3*b[2]))},g.getTimeoutId=function(){return f},a.cycle=g}),define("TWOverflow/Farm/Village",["models/CommandListModel","models/CommandModel","conf/village"],function(a,b,c){function d(a){this.original=a,this.id=a.data.villageId,this.x=a.data.x,this.y=a.data.y,this.name=a.data.name,this.units=a.unitInfo.units,this.position=a.getPosition()}return d.prototype.countCommands=function(){var a=this.original.getCommandListModel();return a.getOutgoingCommands(!0).length+a.getIncomingCommands(!0).length},d.prototype.updateCommands=function(c){var d=this;e.emit(f.GET_OWN_COMMANDS,{village_id:d.id},function(e){for(var f=new a([],d.id),g=0;g<e.commands.length;g++){var h=new b(e.commands[g]);f.add(h)}d.original.setCommandListModel(f),c()})},d.prototype.commandsLoaded=function(){return this.original.isReady(c.OWN_COMMANDS)},d.prototype.unitsLoaded=function(){return this.original.isReady(c.UNITS)},d.prototype.loaded=function(){return!!this.original.isReady()&&(!!this.original.isInitialized()&&(this.commandsLoaded()&&this.unitsLoaded()))},d.prototype.load=function(a){var b=this;return l.ensureVillageDataLoaded(this.id,function(){b.original.isInitialized()||l.initializeVillage(b.original),a()})},d.prototype.getResources=function(){return this.original.getResources().getData().resources},d.prototype.getMaxStorage=function(){return this.original.getResources().getData().maxStorage},d}),define("TWOverflow/Farm/interface",["TWOverflow/Farm","TWOverflow/locale","TWOverflow/Interface","TWOverflow/Interface/buttonLink","TWOverflow/FrontButton","TWOverflow/utils","TWOverflow/eventQueue","helper/time","Lockr","ejs"],function(a,b,c,e,f,g,h,i,k,l){function m(){x=d.getGroupList().getGroups(),w=b("farm","general.disabled");var e={version:a.version,author:{name:"Rafael Mafra",email:"mafrazzrafael@gmail.com",url:"https://github.com/mafrazz"},locale:b};return n=new c("FarmOverflow",{activeTab:"info",template:'<div class="win-content message-list-wrapper searchable-list ng-scope"><header class="win-head"><h2 class="ng-binding"><#= locale("farm", "title") #> <span class="small">v<#= version #></span></h2><ul class="list-btn"><li><a href="#" class="twOverflow-close size-34x34 btn-red icon-26x26-close"></a></li></ul></header><div class="tabs tabs-bg"><div class="tabs-three-col"><div class="tab" tab="info"><div class="tab-inner"><div><a href="#" class="btn-icon btn-orange"><#= locale("common", "info") #></a></div></div></div><div class="tab" tab="settings"><div class="tab-inner"><div><a href="#" class="btn-icon btn-orange"><#= locale("common", "settings") #></a></div></div></div><div class="tab" tab="log"><div class="tab-inner"><div><a href="#" class="btn-icon btn-orange"><#= locale("common", "registers") #></a></div></div></div></div></div><div class="win-main">git<div class="box-paper footer has-footer-upper twOverflow-content-info"><p class="center"><#- locale("farm", "info.developedBy") #> <a href="<#- author.url #>"><#- author.name #></a>&lt;<#- author.email #>&gt;</p><h5 class="twx-section collapse"><#- locale("farm", "info.notice1") #></h5><div><p style="height:80px"><#- locale("farm", "info.notice2") #></p></div><h5 class="twx-section collapse"><#- locale("farm", "info.presets1") #></h5><div><p><#- locale("farm", "info.presets2") #></p><p><#- locale("farm", "info.presets3") #></p><p><#- locale("farm", "info.presets4") #></p><p><#- locale("farm", "info.presets5") #></p><p><span class="sample">Farm (Spears), Farm "Lança", Farm {Light}</span></p><p><#- locale("farm", "info.presets6") #></p></div><h5 class="twx-section collapse"><#- locale("farm", "info.ignore1") #></h5><div><p><#- locale("farm", "info.ignore2") #></p></div><h5 class="twx-section collapse"><#- locale("farm", "info.include1") #></h5><div><p><#- locale("farm", "info.include2") #></p></div><h5 class="twx-section collapse"><#- locale("farm", "info.randomBase1") #></h5><div><p><#- locale("farm", "info.randomBase2") #></p></div><h5 class="twx-section collapse"><#- locale("farm", "info.groupOnly1") #></h5><div><p><#- locale("farm", "info.groupOnly2") #></p></div><h5 class="twx-section collapse"><#- locale("farm", "info.ignoreOnLoss1") #></h5><div><p><#- locale("farm", "info.ignoreOnLoss2") #></p><p><#- locale("farm", "info.ignoreOnLoss3") #></p></div><h5 class="twx-section collapse"><#- locale("farm", "info.priorityTargets1") #></h5><div><p><#- locale("farm", "info.priorityTargets2") #></p></div><h5 class="twx-section collapse"><#- locale("farm", "info.remote1") #></h5><div><p><#- locale("farm", "info.remote2") #></p><p><#- locale("farm", "info.remote3") #></p><p><#- locale("farm", "info.remote4") #></p><p>&bull; <b>on</b> <i><#- locale("farm", "info.remote5") #></i></p><p>&bull; <b>off</b> <i><#- locale("farm", "info.remote6") #></i></p><p>&bull; <b>status</b> <i><#- locale("farm", "info.remote7") #></i></p><p><#- locale("farm", "info.remote8") #></p><p><#- locale("farm", "info.remote9") #></p><p><#- locale("farm", "info.remote10") #></p></div><div></div></div><div class="box-paper footer has-footer-upper twOverflow-content-settings"><form class="settings"><h5 class="twx-section collapse"><#= locale("farm", "settings.basicSettings") #></h5><table class="tbl-border-light tbl-striped"><colgroup><col width="50%"><col></colgroup><tbody><tr><td><span class="icon-34x34-preset"></span> <span class="ff-cell-fix"><#= locale("farm", "settings.presetName") #></span><span class="helper" tooltip="<#= locale("farm", "tooltip.presets") #>">?</span></td><td><select data-setting="presetName" class="preset"></select></td></tr><tr><td><span class="icon-20x20-queue-indicator-short"></span> <span class="ff-cell-fix"><#= locale("farm", "settings.groupIgnore") #></span><span class="helper" tooltip="<#= locale("farm", "tooltip.groupIgnore") #>">?</span></td><td><select data-setting="groupIgnore" class="ignore"></select></td></tr><tr><td><span class="icon-20x20-queue-indicator-long"></span> <span class="ff-cell-fix"><#= locale("farm", "settings.groupInclude") #></span><span class="helper" tooltip="<#= locale("farm", "tooltip.groupInclude") #>">?</span></td><td><select data-setting="groupInclude" class="include"></select></td></tr><tr><td><span class="icon-20x20-favourite"></span> <span class="ff-cell-fix"><#= locale("farm", "settings.groupOnly") #></span><span class="helper" tooltip="<#= locale("farm", "tooltip.groupOnly") #>">?</span></td><td><select data-setting="groupOnly" class="only"></select></td></tr><tr><td><span class="ff-cell-fix"><#= locale("farm", "settings.randomBase") #></span><span class="helper" tooltip="<#= locale("farm", "tooltip.randomBase") #>">?</span></td><td><input data-setting="randomBase" type="number" class="textfield-border" min="0" required></td></tr><tr><td><span class="ff-cell-fix"><#= locale("farm", "settings.maxAttacksPerVillage") #></span><span class="helper" tooltip="<#= locale("farm", "tooltip.maxAttacksPerVillage") #>">?</span></td><td><input data-setting="maxAttacksPerVillage" type="number" class="textfield-border" min="0" max="50" required></td></tr><tr><td><span class="icon-34x34-name_changed"></span> <span class="ff-cell-fix"><#= locale("farm", "settings.priorityTargets") #></span><span class="helper" tooltip="<#= locale("farm", "tooltip.priorityTargets") #>">?</span></td><td><label class="size-26x26 btn-orange icon-26x26-checkbox" for="settings-priorityTargets"><input id="settings-priorityTargets" type="checkbox" data-setting="priorityTargets"></label></td></tr><tr><td><span class="ff-cell-fix"><#- locale("farm", "settings.ignoreOnLoss") #></span><span class="helper" tooltip="<#= locale("farm", "tooltip.ignoreOnLoss") #>">?</span></td><td><label class="size-26x26 btn-orange icon-26x26-checkbox" for="settings-ignoreOnLoss"><input id="settings-ignoreOnLoss" type="checkbox" data-setting="ignoreOnLoss"></label></td></tr><tr><td><span class="ff-cell-fix"><#- locale("farm", "settings.ignoreFullRes") #></span></td><td><label class="size-26x26 btn-orange icon-26x26-checkbox" for="settings-ignoreFullRes"><input id="settings-ignoreFullRes" type="checkbox" data-setting="ignoreFullRes"></label></td></tr></tbody></table><h5 class="twx-section collapse"><#= locale("farm", "settings.singleCycleHeader") #></h5><table class="tbl-border-light tbl-striped"><colgroup><col width="50%"><col></colgroup><tbody><tr><td><span class="ff-cell-fix"><#= locale("farm", "settings.singleCycle") #></span><span class="helper" tooltip="<#= locale("farm", "tooltip.singleCycle") #>">?</span></td><td><label class="size-26x26 btn-orange icon-26x26-checkbox" for="settings-singleCycle"><input id="settings-singleCycle" type="checkbox" data-setting="singleCycle"></label></td></tr><tr><td><span class="ff-cell-fix"><#= locale("farm", "settings.singleCycleNotifs") #></span><span class="helper" tooltip="<#= locale("farm", "tooltip.singleCycleNotifs") #>">?</span></td><td><label class="size-26x26 btn-orange icon-26x26-checkbox" for="settings-singleCycleNotifs"><input id="settings-singleCycleNotifs" type="checkbox" data-setting="singleCycleNotifs"></label></td></tr><tr><td><span class="ff-cell-fix"><#= locale("farm", "settings.singleCycleInterval") #></span><span class="helper" tooltip="<#= locale("farm", "tooltip.singleCycleInterval") #>">?</span></td><td><input data-setting="singleCycleInterval" type="text" class="textfield-border" placeholder="00:00:00"></td></tr></tbody></table><h5 class="twx-section collapse"><#= locale("common", "filters") #></h5><table class="tbl-border-light tbl-striped"><colgroup><col width="50%"><col></colgroup><tbody><tr><td><span class="icon-26x26-double-arrow"></span> <span class="ff-cell-fix"><#= locale("farm", "settings.minDistance") #></span></td><td><input data-setting="minDistance" type="number" class="textfield-border" min="0" max="60" required></td></tr><tr><td><span class="icon-26x26-double-arrow"></span> <span class="ff-cell-fix"><#= locale("farm", "settings.maxDistance") #></span></td><td><input data-setting="maxDistance" type="number" class="textfield-border" min="1" max="60" required></td></tr><tr><td><span class="icon-34x34-points-per-village"></span> <span class="ff-cell-fix"><#= locale("farm", "settings.minPoints") #></span></td><td><input data-setting="minPoints" type="number" class="textfield-border" required></td></tr><tr><td><span class="icon-34x34-points-per-village"></span> <span class="ff-cell-fix"><#= locale("farm", "settings.maxPoints") #></span></td><td><input data-setting="maxPoints" type="number" class="textfield-border" required></td></tr><tr><td><span class="icon-26x26-time"></span> <span class="ff-cell-fix"><#= locale("farm", "settings.maxTravelTime") #></span></td><td><input data-setting="maxTravelTime" type="text" class="textfield-border" pattern="\\d{1,2}:\\d{1,2}:\\d{1,2}" required></td></tr></tbody></table><h5 class="twx-section collapse"><#= locale("common", "registers") #></h5><table class="tbl-border-light tbl-striped"><colgroup><col width="50%"><col></colgroup><tbody><tr><td><span class="icon-26x26-info"></span> <span class="ff-cell-fix"><#= locale("farm", "settings.eventsLimit") #></span></td><td><input data-setting="eventsLimit" type="number" class="textfield-border" min="1" required></td></tr><tr><td><#= locale("farm", "settings.eventAttack") #></td><td><label class="size-26x26 btn-orange icon-26x26-checkbox" for="settings-eventAttack"><input id="settings-eventAttack" type="checkbox" data-setting="eventAttack"></label></td></tr><tr><td><#= locale("farm", "settings.eventVillageChange") #></td><td><label class="size-26x26 btn-orange icon-26x26-checkbox" for="settings-eventVillageChange"><input id="settings-eventVillageChange" type="checkbox" data-setting="eventVillageChange"></label></td></tr><tr><td><#= locale("farm", "settings.eventPriorityAdd") #></td><td><label class="size-26x26 btn-orange icon-26x26-checkbox" for="settings-eventPriorityAdd"><input id="settings-eventPriorityAdd" type="checkbox" data-setting="eventPriorityAdd"></label></td></tr><tr><td><#= locale("farm", "settings.eventIgnoredVillage") #></td><td><label class="size-26x26 btn-orange icon-26x26-checkbox" for="settings-eventIgnoredVillage"><input id="settings-eventIgnoredVillage" type="checkbox" data-setting="eventIgnoredVillage"></label></td></tr></tbody></table><h5 class="twx-section collapse"><#= locale("common", "others") #></h5><table class="tbl-border-light tbl-striped"><colgroup><col width="50%"><col></colgroup><tbody><tr><td><span class="icon-26x26-message-misc"></span> <span class="ff-cell-fix"><#= locale("farm", "settings.remote") #></span><span class="helper" tooltip="<#= locale("farm", "tooltip.remote") #>">?</span></td><td><input data-setting="remoteId" type="text" class="textfield-border" min="3" max="45"></td></tr><tr><td><#= locale("farm", "settings.hotkeySwitch") #></td><td><input data-setting="hotkeySwitch" type="text" class="textfield-border"></td></tr><tr><td><#= locale("farm", "settings.hotkeyWindow") #></td><td><input data-setting="hotkeyWindow" type="text" class="textfield-border"></td></tr></tbody></table></form></div><div class="box-paper footer has-footer-upper twOverflow-content-log"><div class="screen-tribe-news rich-text"><h5 class="twx-section collapse"><#= locale("common", "status") #></h5><table class="tbl-border-light tbl-news tbl-big-header"><colgroup><col width="135px"><col width="*"></colgroup><tbody><tr class="list-item"><td class="status" colspan="2" class="cell-center"><#= locale("common", "paused") #></td></tr><tr class="reduced"><td><#= locale("farm", "events.selectedVillage") #></td><td class="selected"></td></tr><tr class="reduced"><td><#= locale("farm", "events.lastAttack") #></td><td class="last"><#= locale("common", "none") #></td></tr></tbody></table><h5 class="twx-section collapse"><#= locale("common", "registers") #></h5><table class="tbl-border-light tbl-news tbl-big-header"><colgroup><col width="76px"><col></colgroup><tbody class="events"><tr class="reduced nothing"><td colspan="2"><div><span><#= locale("farm", "events.nothingYet") #></span></div></td></tr></tbody></table></div></div></div><footer class="win-foot"><ul class="list-btn list-center"><li class="twOverflow-button-settings"><a class="btn-orange btn-border save"><#= locale("common", "save") #></a></li><li><a class="btn-green btn-border start"><#= locale("common", "start") #></a></li></ul></footer></div>',replaces:e,css:'#FarmOverflow input[type="text"],#FarmOverflow input[type="number"],#FarmOverflow select{color:#000;min-width:70%}#FarmOverflow .info a{font-weight:bold;color:#544231}#FarmOverflow .settings .helper{font-weight:bold;vertical-align:-1px;font-family:helvetica;color:rgba(0,0,0,0.3)}#FarmOverflow .settings .helper:hover{color:#000}#FarmOverflow .settings [class^="icon-"]{display:inline;margin:0 9px 0 0}#FarmOverflow .settings .icon-34x34-preset,#FarmOverflow .settings .icon-26x26-time,#FarmOverflow .settings .icon-26x26-info,#FarmOverflow .settings .icon-26x26-double-arrow{zoom:.6}#FarmOverflow .settings .icon-20x20-queue-indicator-short,#FarmOverflow .settings .icon-20x20-queue-indicator-long,#FarmOverflow .settings .icon-20x20-favourite{vertical-align:0;margin:0 5px 0 0}#FarmOverflow .settings .icon-34x34-preset,#FarmOverflow .settings .icon-26x26-time{vertical-align:3px}#FarmOverflow .settings .icon-26x26-double-arrow{vertical-align:4px}#FarmOverflow .settings .icon-26x26-info{vertical-align:5px}#FarmOverflow .settings .icon-34x34-points-per-village,#FarmOverflow .settings .icon-34x34-name_changed{zoom:.5;vertical-align:6px}#FarmOverflow .settings .icon-26x26-message-misc{vertical-align:1px}#FarmOverflow .settings .icon-34x34-general{zoom:.5}#FarmOverflow .settings .icon-26x26-time-spy{zoom:.7}#FarmOverflow .settings td{text-align:center}#FarmOverflow .events tr{height:30px}#FarmOverflow .events tr td.tribe-event-time{white-space:nowrap}'}),o=new f("Farm"),o.hover(M),o.click(function(){n.openWindow()}),p=$(n.$window),q=p.find(".events"),r=p.find(".last"),s=p.find(".status"),t=p.find(".start"),u=p.find(".settings"),v=p.find(".preset"),y={groupIgnore:p.find(".ignore"),groupInclude:p.find(".include"),groupOnly:p.find(".only")},h.bind("Farm/sendCommand",function(c,d){if(s.html(b("farm","events.attacking")),J(i.gameTime()),!a.settings.eventAttack)return!1;G({links:{origin:{type:"village",name:g.genVillageLabel(c),id:c.id},target:{type:"village",name:g.genVillageLabel(d),id:d.id}},icon:"attack-small",type:"sendCommand"})}),h.bind("Farm/nextVillage",function(b){if(I(),!a.settings.eventVillageChange)return!1;G({links:{village:{type:"village",name:g.genVillageLabel(b),id:b.id}},icon:"village",type:"nextVillage"})}),h.bind("Farm/ignoredVillage",function(b){if(!a.settings.eventIgnoredVillage)return!1;G({links:{target:{type:"village",name:g.genVillageLabel(b),id:b.id}},icon:"check-negative",type:"ignoredVillage"})}),h.bind("Farm/priorityTargetAdded",function(b){if(!a.settings.eventPriorityAdd)return!1;G({links:{target:{type:"village",name:g.genVillageLabel(b),id:b.id}},icon:"parallel-recruiting",type:"priorityTargetAdded"})}),h.bind("Farm/noPreset",function(){G({icon:"info",type:"noPreset"}),s.html(b("common","paused"))}),h.bind("Farm/noUnits",function(){a.isSingleVillage()&&s.html(b("farm","events.noUnits"))}),h.bind("Farm/noUnitsNoCommands",function(){s.html(b("farm","events.noUnitsNoCommands"))}),h.bind("Farm/start",function(){s.html(b("farm","events.attacking"))}),h.bind("Farm/pause",function(){s.html(b("common","paused"))}),h.bind("Farm/noVillages",function(){s.html(b("farm","events.noVillages"))}),h.bind("Farm/singleCycleEnd",function(){s.html(b("farm","events.singleCycleEnd"))}),h.bind("Farm/singleCycleNext",function(){var c=i.gameTime()+a.cycle.getInterval();s.html(b("farm","events.singleCycleNext",{time:g.formatDate(c)}))}),h.bind("Farm/singleCycleNextNoVillages",function(){var c=i.gameTime()+a.cycle.getInterval();s.html(b("farm","events.singleCycleNextNoVillages",{time:g.formatDate(c)}))}),h.bind("Farm/villagesUpdate",function(){I()}),h.bind("Farm/startLoadingTargers",function(){s.html(b("farm","events.loadingTargets"))}),h.bind("Farm/endLoadingTargers",function(){s.html(b("farm","events.analyseTargets"))}),h.bind("Farm/attacking",function(){s.html(b("farm","events.attacking"))}),h.bind("Farm/commandLimitSingle",function(){s.html(b("farm","events.commandLimit"))}),h.bind("Farm/commandLimitMulti",function(){s.html(b("farm","events.noVillages"))}),h.bind("Farm/resetEvents",function(){z=0,E()}),h.bind("Farm/groupsChanged",function(){K()}),h.bind("Farm/presetsLoaded",function(){L()}),h.bind("Farm/presetsChange",function(){L()}),h.bind("Farm/start",function(){t.html(b("common","pause")),t.removeClass("btn-green").addClass("btn-red"),o.$elem.removeClass("btn-green").addClass("btn-red")}),h.bind("Farm/pause",function(){t.html(b("common","start")),t.removeClass("btn-red").addClass("btn-green"),o.$elem.removeClass("btn-red").addClass("btn-green")}),h.bind("Farm/settingError",function(a,c){var d="settingError."+a;g.emitNotif("error",b("farm",d,c))}),d.getPresetList().isLoaded()&&L(),D(),F(),K(),I(),J(),E(),n}var n,o,p,q,r,s,t,u,v,w,x,y,z=1,A=/(\(|\{|\[|\"|\')[^\)\}\]\"\']+(\)|\}|\]|\"|\')/,B=function(a){p.find("[data-setting]").forEach(function(b){var c=b.dataset.setting;a(b,c)})},C=function(){var c={};return B(function(b,d){switch(a.settingsMap[d].inputType){case"text":c[d]="number"===b.type?parseInt(b.value,10):b.value;break;case"select":c[d]=b.dataset.value;break;case"checkbox":c[d]=b.checked}}),!!a.updateSettings(c)&&(g.emitNotif("success",b("farm","settings.saved")),!0)},D=function(){B(function(b,c){switch(a.settingsMap[c].inputType){case"text":b.value=a.settings[c];break;case"select":b.dataset.value=a.settings[c];break;case"checkbox":a.settings[c]&&(b.checked=!0,b.parentElement.classList.add("icon-26x26-checkbox-checked"))}})},E=function(){var b=a.getLastEvents();b.length>0&&q.find(".nothing").remove(),b.some(function(b){return z>=a.settings.eventsLimit||!(!a.settings.eventAttack&&"sendCommand"===b.type)&&(!(!a.settings.eventVillageChange&&"nextVillage"===b.type)&&(!(!a.settings.eventPriorityAdd&&"priorityTargetAdded"===b.type)&&(!(!a.settings.eventIgnoredVillage&&"ignoredVillage"===b.type)&&void G(b,!0))))})},F=function(){j.add(a.settings.hotkeySwitch,function(){a.switch()}),j.add(a.settings.hotkeyWindow,function(){n.openWindow()}),t.on("click",function(){a.switch()}),p.find(".save").on("click",function(a){C()})},G=function(b,c){q.find(".nothing").remove(),z>=a.settings.eventsLimit&&q.find("tr:last-child").remove();var d=a.getLastEvents();d.length>=a.settings.eventsLimit&&d.pop(),H(q,b,c),z++,c||(b.timestamp=i.gameTime(),d.unshift(b),a.setLastEvents(d))},H=function(a,c,d){var f={},h={},j=c.links,k=c.timestamp||i.gameTime(),m=document.createElement("tr");if(j){for(var o in j)f[o]=e(j[o].type,j[o].name,j[o].id),h[o]='<a id="'+f[o].id+'"></a>';c.content=b("farm","events."+c.type,h)}var p=g.formatDate(k),q=g.formatDate(k,"HH:mm:ss");if(m.innerHTML=l.render('<td class="tribe-event-time" tooltip="<#= longDate #>"><#= shortDate #></td><td class="tribe-event-detail"><span class="icon-bg-black icon-26x26-<#= icon #>"></span><div class="text-tribe-news"><span><#- content #></span></div></td>',{longDate:p,shortDate:q,icon:c.icon,content:c.content}),j)for(var o in f)m.querySelector("#"+f[o].id).replaceWith(f[o].elem);a[d?"append":"prepend"](m),n.isVisible("log")&&n.recalcScrollbar(),n.setTooltips()},I=function(){var c=p.find(".selected"),d=a.getSelectedVillage();if(!d)return c.html(b("common","none"));var f=e("village",g.genVillageLabel(d),d.id);c.html(""),c.append(f.elem)},J=function(b){if(!b&&-1===(b=a.getLastAttack()))return!1;r.html(g.formatDate(b)),M()},K=function(){for(var b in y){var c=y[b].find(".custom-select-handler").html(""),d=y[b].find(".custom-select-data").html("");N(d,"0");for(var e in x){var f=x[e].name;a.settings[b];""===a.settings[b]?(c.html(w),y[b][0].dataset.name=w,y[b][0].dataset.value=""):a.settings[b]==e&&(c.html(f),y[b][0].dataset.name=f,y[b][0].dataset.value=e),O(d,{name:f,value:e,icon:x[e].icon}),y[b].append(d)}a.settings[b]||c.html(w)}},L=function(){var b={},c=d.getPresetList().presets,e=!1,f=a.settings.presetName,g=v.find(".custom-select-handler").html(""),h=v.find(".custom-select-data").html("");N(h);for(var i in c){var j=c[i].name.replace(A,"").trim();j in b||j&&(""===f?(g.html(w),v[0].dataset.name=w,v[0].dataset.value=""):f===j&&(g.html(j),v[0].dataset.name=j,v[0].dataset.value=j,e=!0),O(h,{name:j,value:j,icon:"size-34x34 icon-26x26-preset"}),b[j]=!0)}e||(g.html(w),v[0].dataset.name=w,v[0].dataset.value="")},M=function(){var a=b("farm","events.lastAttack"),c=a+": "+r.html();o.updateQuickview(c)},N=function(a,b){var c=document.createElement("span");c.dataset.name=w,c.dataset.value=b||"",a.append(c)},O=function(a,b){var c=document.createElement("span");for(var d in b)c.dataset[d]=b[d];a.append(c)};a.interface=function(){a.interface=m()}}),require(["TWOverflow/ready","TWOverflow/Farm","TWOverflow/Farm/interface","TWOverflow/Farm/analytics","TWOverflow/Farm/singleCycle"],function(a,b){if(b.isInitialized())return!1;a(function(){b.init(),b.interface(),b.analytics()})}),define("TWOverflow/Interface",["TWOverflow/utils","queues/EventQueue","helper/dom","ejs"],function(b,d,e,f){function h(a,b){var d=this;return k.push(d),d.windowId=a,d.activeTab=b.activeTab,d.settings=b,m(a,b.css),d.buildWindow(),d.bindTabs(),d.setCollapse(),d.setTooltips(),d.setCheckboxes(),d.setSelects(),d.$window.querySelector(".twOverflow-close").addEventListener("click",function(){d.closeWindow()}),c.$on(g.WINDOW_CLOSED,function(){d.closeWindow()}),d}var j=!1,k=[],l=function(){k.forEach(function(a){a.closeWindow()})},m=function(a,b){var c=document.createElement("style");c.type="text/css",c.id="twOverflow-style-"+a,c.innerHTML=b,document.querySelector("head").appendChild(c)},n=function(d){var e=!1,f=document.createElement("span"),h=document.createElement("span"),i=document.createElement("span"),j=document.createElement("span"),k=function(a){var c=a.srcElement||a.target;b.matchesElem(c,".custom-select")||l()},l=function(){c.$broadcast(g.SELECT_HIDE,"custom-select"),$(a).off("click",k),$(".win-main").off("mousewheel",l),e=!1,o()},m=function(a,b){h.innerHTML=a.name,f.dataset.name=a.name,f.dataset.value=a.value,$(f).trigger("selectSelected"),l()},n=function(){i.classList.remove("icon-26x26-arrow-down"),i.classList.add("icon-26x26-arrow-up")},o=function(){i.classList.remove("icon-26x26-arrow-up"),i.classList.add("icon-26x26-arrow-down")};d.querySelectorAll("option").forEach(function(a){var b=document.createElement("span");b.dataset.name=a.innerText,b.dataset.value=a.value,j.appendChild(b),a.hasAttribute("selected")&&(h.innerHTML=a.innerText,f.dataset.name=a.innerText,f.dataset.value=a.value)});for(var p in d.dataset)f.dataset[p]=d.dataset[p];f.className="custom-select "+d.className,i.className="custom-select-button icon-26x26-arrow-down",h.className="custom-select-handler",j.className="custom-select-data",f.appendChild(h),f.appendChild(i),f.appendChild(j),f.addEventListener("click",function(){if(e)return l();var b=j.querySelectorAll("span"),d=[],i={};b.forEach(function(a){var b={name:a.dataset.name,value:a.dataset.value};a.dataset.icon&&(b.leftIcon=isNaN(a.dataset.icon)?a.dataset.icon:parseInt(a.dataset.icon,10)),a.dataset.name===h.innerHTML&&(i=b),d.push(b)}),c.$broadcast(g.SELECT_SHOW,"custom-select",d,i,m,f,!0),e=!0,n(),$(".win-main").on("mousewheel",l),$(a).on("click",k)}),d.replaceWith(f)};return h.prototype.buildWindow=function(){this.$wrapper=$("#wrapper"),
this.$window=document.createElement("section"),this.$window.id=this.windowId,this.$window.className="twOverflow-window twx-window screen left",this.$window.innerHTML=f.render(this.settings.template,this.settings.replaces),this.$wrapper.append(this.$window),this.$scrollbar=jsScrollbar(this.$window.querySelector(".win-main"))},h.prototype.openWindow=function(){i.closeAll(),l(),this.$window.style.visibility="visible",this.$wrapper.addClass("window-open"),this.resizeWindowFrame()},h.prototype.resizeWindowFrame=function(){d.trigger(d.types.RESIZE,{instant:!0,right:!0})},h.prototype.closeWindow=function(){this.$window.style.visibility="hidden",this.$wrapper.removeClass("window-open"),this.resizeWindowFrame()},h.prototype.toggleWindow=function(a){this.$window.style.visibility=a,this.$wrapper.toggleClass("window-open"),this.resizeWindowFrame()},h.prototype.tabsState=function(a,b){var c=this;if(a===b)return!1;c.$tabs.forEach(function(d){var e=d.getAttribute("tab");if(e!==a&&e!==b)return!1;c.$window.querySelector(".twOverflow-content-"+e),c.$window.querySelectorAll(".twOverflow-button-"+e),d.querySelector(".tab-inner > div"),d.querySelector("a");e===a?c.disableTab(e,d):e===b&&c.enableTab(e,d)})},h.prototype.bindTabs=function(){var a=this;a.$tabs=a.$window.querySelectorAll(".tab"),a.$tabs.forEach(function(b){var c=b.getAttribute("tab");b.addEventListener("click",function(){a.tabsState(a.activeTab,c),a.activeTab=c}),a.activeTab===c?a.enableTab(c,b):a.disableTab(c,b),a.recalcScrollbar()})},h.prototype.enableTab=function(a,b){var c=this.$window.querySelector(".twOverflow-content-"+a),d=this.$window.querySelectorAll(".twOverflow-button-"+a),e=b.querySelector(".tab-inner > div"),f=b.querySelector("a");c.style.display="",b.classList.add("tab-active"),e.classList.add("box-border-light"),f.classList.remove("btn-icon","btn-orange"),d.length&&d.forEach(function(a){a.style.display=""}),this.$scrollbar.content=c,this.recalcScrollbar()},h.prototype.disableTab=function(a,b){var c=this.$window.querySelector(".twOverflow-content-"+a),d=this.$window.querySelectorAll(".twOverflow-button-"+a),e=b.querySelector(".tab-inner > div"),f=b.querySelector("a");c.style.display="none",b.classList.remove("tab-active"),e.classList.remove("box-border-light"),f.classList.add("btn-icon","btn-orange"),d.length&&d.forEach(function(a){a.style.display="none"})},h.prototype.destroy=function(){document.querySelector("#twOverflow-style-"+this.windowId).remove(),this.$window.remove()},h.prototype.setCollapse=function(){var a=this;a.$window.querySelectorAll(".twx-section.collapse").forEach(function(b){var c=!b.classList.contains("hidden-content"),d=document.createElement("span");d.className="min-max-btn";var e=document.createElement("a");e.className="btn-orange icon-26x26-"+(c?"minus":"plus"),c||(b.nextSibling.style.display="none"),d.appendChild(e),b.appendChild(d),d.addEventListener("click",function(){"none"===b.nextSibling.style.display?(b.nextSibling.style.display="",e.className=e.className.replace("plus","minus"),c=!0):(b.nextSibling.style.display="none",e.className=e.className.replace("minus","plus"),c=!1),a.recalcScrollbar()})})},h.prototype.setTooltips=function(){var a=this,b=$("#tooltip");b.find(".tooltip-content-wrapper");a.$window.querySelectorAll("[tooltip]").forEach(function(a){var b=a.getAttribute("tooltip");a.removeAttribute("tooltip"),a.addEventListener("mouseenter",function(a){c.$broadcast(g.TOOLTIP_SHOW,"twoverflow-tooltip",b,!0,a)}),a.addEventListener("mouseleave",function(){c.$broadcast(g.TOOLTIP_HIDE,"twoverflow-tooltip")})})},h.prototype.setCheckboxes=function(){this.$window.querySelectorAll("input[type=checkbox]").forEach(function(a){a.addEventListener("click",function(){$(a).parent().toggleClass("icon-26x26-checkbox-checked")})})},h.prototype.isVisible=function(a){var b="visible"===this.$window.style.visibility;return b&&a&&(b=this.activeTab===a),b},h.prototype.recalcScrollbar=function(){this.$scrollbar.recalc()},h.prototype.setSelects=function(){this.$window.querySelectorAll("select").forEach(function(a){n(a)})},h.init=function(){j=!0,m("own",'#twOverflow-leftbar{position:relative;top:0;left:0;margin-bottom:7px}#twOverflow-leftbar .button{white-space:nowrap;position:relative;top:-17px;left:0;width:60px;height:24px}#twOverflow-leftbar .label,#twOverflow-leftbar .quickview{margin:5px 0;font-size:12px}#twOverflow-leftbar .quickview{display:none}#wrapper.window-open #twOverflow-leftbar .button{left:720px}.twOverflow-window{visibility:hidden}.twOverflow-window h3{color:#000}.twOverflow-window p{color:#000;margin:7px 0;padding:0 40px}.twOverflow-window p span.sample{font-weight:bold;font-style:italic}.twOverflow-window p span.brazil{color:green;font-weight:bold}.twOverflow-window p .opensource{background:url(https://i.imgur.com/KFHdWXN.png);width:15px;height:15px;display:inline-block;vertical-align:-2px}.twOverflow-window input::placeholder{color:#6d563c}.twOverflow-window input[type="text"],.twOverflow-window input[type="number"],.twOverflow-window select{color:black;text-align:center}.twOverflow-window select{width:100%;padding:0 0 0 5px;font-size:14px;border:1px solid #976543;height:28px;text-decoration:none;text-align-last:center;border-radius:2px;font-weight:600;font-family:"Trebuchet MS";color:white;box-shadow:0 0 0 1px #421f09 inset,0 0 0 2px #976543 inset,0 0 0 3px #421f09 inset,0 -1px 1px 4px rgba(215,181,144,0.7) inset,0 0 1px 5px rgba(0,0,0,0.4) inset;-webkit-appearance:none;-moz-appearance:none;outline:none;background-image:url(https://i.imgur.com/SlaWRrX.png),url(https://i.imgur.com/e2qKrmX.png);background-repeat:no-repeat,repeat;background-position:293px -3px,top left;background-color:#b28e68}.twOverflow-window .custom-select{position:relative;display:inline-block;min-width:70%}.twOverflow-window .custom-select .custom-select-button{height:21px;position:absolute;right:1px;top:1px}.twOverflow-window .custom-select .custom-select-handler{text-align:center;line-height:25px;height:25px;display:block;background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAMAAAAp4XiDAAAABGdBTUEAALGPC/xhBQAAALRQTFRFr6+vmJiYoKCgrKysq6urpaWltLS0s7OzsLCwpKSkm5ubqKiojY2NlZWVk5OTqampbGxsWFhYUVFRhISEgYGBmpqaUFBQnp6eYmJidnZ2nZ2dY2NjW1tbZ2dnoaGhe3t7l5eXg4ODVVVVWVlZj4+PXFxcVlZWkpKSZmZmdXV1ZWVlc3NzjIyMXl5eVFRUeHh4hoaGYWFhXV1dbW1tampqb29veXl5fHx8gICAiYmJcnJyTk5Ooj6l1wAAADx0Uk5TGhkZGhoaGxoaGRkaGRkZGhkbHBgYGR0ZGhkZGhsZGRgZGRwbGRscGRoZGhkZGhwZGRobGRkZGRkZGRkeyXExWQAABOJJREFUSMeNVgdy4zgQxIW9TQ7KOVEUo5gz0f//1/WA0sple6+OLokQiUk9PQ2rvlzvT0vA6xDXU3R5hQmqddDVaIELsMl3KLUGoFHugUphjt25PWkE6KMAqPkO/Qh7HRadPmTNxKJpWuhSjLZAoSZmXYoPXh0w2R2z10rjBxpMNRfomhbNFUfUFbfUCh6TWmO4ZqNn6Jxekx6lte3h9IgYv9ZwzIZXfhQ/bejmsYkgOeVInoDGT6KGP9MMbsj7mtEKphKgVFKkJGUM+r/00zybNkPMFWYske+jY9hUblbrK4YosyPtrxl+5kNRWSb2B3+pceKT05SQRPZY8pVSGoWutgen2junRVKPZJ0v5Nu9HAk/CFPr+T1XTkXYFWSJXfTyLPcpcPXtBZIPONq/cFQ0Y0Lr1GF6f5doHdm2RLTbQMpMmCIf/HGm53OLFPiiEOsBKtgHccgKTVwn8l7kbt3iPvqniMX4jgWj4aqlX43xLwXVet5XTG1cYp/29m58q6ULSa7V0M3UQFyjd+AD+1W9WLBpDd9uej7emFbea/+Yw8faySElQQrBDksTpTOVIG/SE2HpPvZsplJWsblRLEGXATEW9YLUY1rPSdivBDmuK3exNiAysfPALfYZFWJrsA4Zt+fftEeRY0UsMDqfyNCKJpdrtI1r2k0vp9LMSwdO0u5SpjBeEYz5ebhWNbwT2g7OJXy1vjW+pEwyd1FTkAtbzzcbmX1yZlkR2pPiXZ/mDbPNWvHRsaKfLH8+FqiZbnodbOK9RGWlNMli8k+wsgbSNwS35QB6qxn53xhu2DFqUilisB9q2Zqw4nNI9tOB2z8GbkvEdNjPaD2j+9pwEC+YlWJvI7xN7xMC09eqhq/qwRvz3JWcFWmkjrWBWSiOysEmc4LmMb0iSsxR8+Z8pk3+oE39cdAmh1xSDXuAryRLZgpp9V62+8IOeBSICjs8LlbtKGN4E7XGoGASIJ+vronVa5mjagPHIFJA2b+BKkZC5I/78wOqmzYp1N8vzTkWIWz6YfsS3eh3w8pBkfKz6TSLxK9Qai5DUGTMZ8NNmrW8ldNudIJq+eJycwjv+xbeOJwPv1jjsSV/rCBaS/IBrafaUQ+5ksHwwl9y9X7kmvvIKWoBDFvbWySGyMU3XflxZRkNeRU63otWb0+P8H8BrRokbJivpWkk6m6LccSlrC2K0i6+4otx4dN3mbAVKt0wbaqBab4/MW8rgrS8JP06HU6UYSTYsQ5pYETpo87ZonORvbPlvYbXwmsMgoQGKr8PUQ5dDEO0EcXp2oOfSk+YpR/Eg4R46O0/Sf7jVnbqbXBrRkCPsZFOQTN8h+aqlcRw9FjJ/j8V7SXZ3hVNXYsOYcxzpfPNgFrvB9S6Dej2PqDqq0su+5ng0WMi527p/pA+OiW0fsYzDa6sPS9C1qxTtxVRMuySrwPD6qGPRKc4uIx4oceJ9FPjxWaqPPebzyXxU7W1jNqqOw+9z6X/k+Na3SBa0v+VjgoaULR30G1nxvZN1vsha2UaSrKy/PyCaHK5zAYnJzm9RSpSPDWbDVu0dkUujMmB/ly4w8EnDdXXoyX/VfhB3yKzMJ2BSaZO+A9GiNQMbll+6z1WGLWpEGMeEg85MESSep0IPFaHYZZ1QOW/xcjfxGhNjP0tRtbhFHOmhhjAv/p77JrCX3+ZAAAAAElFTkSuQmCC") top left #ceab84;box-shadow:inset 0 0 0 1px #533a1f,inset 0 0 0 2px #dcba94,0 0 2px rgba(0,0,0,0.6);padding:0 10px}.twOverflow-window .custom-select .custom-select-data{display:none}.twOverflow-window .center{text-align:center}.twOverflow-window .reduced{height:30px}@keyframes expand-button{0%{width:60px}100%{width:250px}}@keyframes contract-button{0%{width:250px}100%{width:60px}}.expand-button{animation:expand-button .1s forwards}.contract-button{animation:contract-button .1s forwards}.icon-26x26-preset{background-image:url(https://i.imgur.com/ozI4k0h.png);background-position:-884px -984px;zoom:.8;margin-top:2px;margin-left:5px}')},h.isInitialized=function(){return j},h}),define("TWOverflow/Interface/buttonLink",["ejs"],function(a){return function(b,c,d){var e=Math.round(1e5*Math.random()),f=a.render('<a id="l<#= uid #>" class="img-link icon-20x20-<#= type #> btn btn-orange padded"><#= text #></a>',{type:b,text:c,uid:e}),g=document.createElement("div");g.innerHTML=f,g=g.firstChild;var i;switch(b){case"village":i=function(){h.openVillageInfo(d)};break;case"character":i=function(){h.openCharacterProfile(d)}}return g.addEventListener("click",i),{html:f,id:"l"+e,elem:g}}}),define("TWOverflow/FrontButton",["ejs"],function(a){function b(a,b){this.options=b=angular.merge({label:a,className:"",classHover:"expand-button",classBlur:"contract-button",tooltip:!1},b),this.buildWrapper(),this.appendButton();var d=this.$elem,e=d.find(".label"),f=d.find(".quickview");return b.classHover&&d.on("mouseenter",function(){d.addClass(b.classHover),d.removeClass(b.classBlur),e.hide(),f.show()}),b.classBlur&&d.on("mouseleave",function(){d.addClass(b.classBlur),d.removeClass(b.classHover),f.hide(),e.show()}),b.tooltip&&(d.on("mouseenter",function(a){c.$broadcast(g.TOOLTIP_SHOW,"twoverflow-tooltip",b.tooltip,!0,a)}),d.on("mouseleave",function(){c.$broadcast(g.TOOLTIP_HIDE,"twoverflow-tooltip")})),this}return b.prototype.updateQuickview=function(a){this.$elem.find(".quickview").html(a)},b.prototype.hover=function(a){this.$elem.on("mouseenter",a)},b.prototype.click=function(a){this.$elem.on("click",a)},b.prototype.buildWrapper=function(){var a=document.getElementById("twOverflow-leftbar");a||(a=document.createElement("div"),a.id="twOverflow-leftbar",$("#toolbar-left").prepend(a)),this.$wrapper=a},b.prototype.appendButton=function(){var b=a.render('<div class="btn-border btn-green button <#= className #>" id="twOverflow-leftbar"><div class="top-left"></div><div class="top-right"></div><div class="middle-top"></div><div class="middle-bottom"></div><div class="middle-left"></div><div class="middle-right"></div><div class="bottom-left"></div><div class="bottom-right"></div><div class="label"><#= label #></div><div class="quickview"></div></div>',{className:this.options.className,label:this.options.label}),c=document.createElement("div");c.innerHTML=b;var d=c.children[0];this.$wrapper.appendChild(d),this.$elem=$(d)},b.prototype.destroy=function(){this.$elem.remove()},b}),require(["TWOverflow/ready","TWOverflow/Interface"],function(a,b){if(b.isInitialized())return!1;a(function(){b.init()})})}(this);
//# sourceMappingURL=tw2overflow.map
